{"ast":null,"code":"import _regeneratorRuntime from\"/Users/dcurchin/Desktop/final/grocery-shop-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/dcurchin/Desktop/final/grocery-shop-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _defineProperty from\"/Users/dcurchin/Desktop/final/grocery-shop-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _objectSpread from\"/Users/dcurchin/Desktop/final/grocery-shop-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"/Users/dcurchin/Desktop/final/grocery-shop-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{Typography,Box,Divider}from'@mui/material';import{React,useState}from'react';import{Link,useHistory}from'react-router-dom';import ContactInformation from'./ContactInformation';import SaveInformation from'./SaveInformation';import ShippingAddress from'./ShippingAddress';import CommonButton from'../common/buttons/CommonButton';import{useDispatch,useSelector}from'react-redux';import{emailValidation}from'../../helpers/emailValidation';import axios from'axios';import{anyString255Validation}from'../../helpers/anyString255Validation';import{setIsChecked,setDataInDb}from'../../redux/slices/checkoutSlice';import{rewriteCart}from'../../redux/slices/cartSlice';import AccordionComponent from'./AccordionComponent';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var mainStyle={paddingRight:'4em',paddingTop:'4em',paddingLeft:'14%',color:'#333333',width:'55%',display:'flex',flexDirection:'column',gap:'12px',backgroundColor:'#fff','@media (max-width : 1000px)':{width:'100%',paddingTop:'1.5em',paddingLeft:'15%',paddingRight:'15%'},'@media (max-width: 750px)':{display:'block'}};var bottomButtons={display:'flex',alignItems:'baseline',gap:'18px',marginBottom:'4em','& a':{textDecoration:'none',color:'primary.main','@media (max-width: 750px)':{paddingTop:'15px',width:'100%',display:'flex',justifyContent:'center',alignItems:'center','&::before':{content:'\"❮\"',paddingRight:'5px'}}},'@media (max-width: 750px)':{display:'block',marginBottom:'3em'}};var checkoutButtonStyle={borderRadius:'5px',color:'white',padding:'14px 24px',fontSize:'20px',width:'190px',textTransform:'none','&:hover':{backgroundColor:'secondary.main'},'@media (max-width: 750px)':{width:'100%'}};var Main=function Main(){var dispatch=useDispatch();var history=useHistory();var auth=useSelector(function(state){return state.auth;});var token=auth.token,isAuth=auth.isAuth;var checkout=useSelector(function(state){return state.checkout;});var needToSave=checkout.needToSave,email=checkout.email,firstName=checkout.firstName,lastName=checkout.lastName,address=checkout.address,apartment=checkout.apartment;var cart=useSelector(function(state){return state.cart;});var cartItems=cart.cartItems;var getTotalPrice=function getTotalPrice(){var reducer=function reducer(acc,item){return acc+item.quantity*item.price*item.size;};return cartItems.reduce(reducer,0);};var totalPrice=getTotalPrice().toFixed(2);var _useState=useState({email:email||'',errorEmail:'',firstName:firstName||'',errorFirstName:'',lastName:lastName||'',errorLastName:'',address:address||'',errorAddress:'',apartment:apartment||'',errorApartment:''}),_useState2=_slicedToArray(_useState,2),state=_useState2[0],setState=_useState2[1];var handleChange=function handleChange(e){var _objectSpread2;setState(_objectSpread(_objectSpread({},state),{},(_objectSpread2={},_defineProperty(_objectSpread2,e.target.name,e.target.value),_defineProperty(_objectSpread2,\"errorEmail\",e.target.name==='email'?'':state.errorEmail),_defineProperty(_objectSpread2,\"errorFirstName\",e.target.name==='firstName'?'':state.errorFirstName),_defineProperty(_objectSpread2,\"errorLastName\",e.target.name==='lastName'?'':state.errorLastName),_defineProperty(_objectSpread2,\"errorAddress\",e.target.name==='address'?'':state.errorAddress),_defineProperty(_objectSpread2,\"errorApartment\",e.target.name==='apartment'?'':state.errorApartment),_objectSpread2)));};var handleCheck=function handleCheck(e){dispatch(setIsChecked(e.target.checked));};var handleClick=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(e){var response,_response;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:e.preventDefault();if(!(emailValidation(state,setState)&&anyString255Validation(state,setState,'firstName','errorFirstName')&&anyString255Validation(state,setState,'lastName','errorLastName')&&anyString255Validation(state,setState,'address','errorAddress')&&anyString255Validation(state,setState,'apartment','errorApartment'))){_context.next=29;break;}_context.prev=2;if(!(isAuth&&needToSave)){_context.next=10;break;}_context.next=6;return axios({method:'post',url:'/api/checkout',headers:{Authorization:token},data:{needToSave:true,totalPrice:totalPrice,email:state.email,firstName:state.firstName,lastName:state.lastName,address:state.address,apartment:state.apartment,orderList:cartItems}});case 6:response=_context.sent;if(response.status===201){dispatch(setDataInDb({needToSave:true,email:state.email,firstName:state.firstName,lastName:state.lastName,address:state.address,apartment:state.apartment}));dispatch(rewriteCart([]));history.push('/');}_context.next=22;break;case 10:if(!(isAuth&&!needToSave)){_context.next=17;break;}_context.next=13;return axios({method:'post',url:'/api/checkout',headers:{Authorization:token},data:{needToSave:false,totalPrice:totalPrice,email:state.email,firstName:state.firstName,lastName:state.lastName,address:state.address,apartment:state.apartment,orderList:cartItems}});case 13:_response=_context.sent;if(_response.status===201){dispatch(setDataInDb({needToSave:false,email:'',firstName:'',lastName:'',address:'',apartment:''}));dispatch(rewriteCart([]));history.push('/');}_context.next=22;break;case 17:if(isAuth){_context.next=22;break;}_context.next=20;return axios({method:'post',url:'/api/checkout',data:{needToSave:false,totalPrice:totalPrice,email:state.email,firstName:state.firstName,lastName:state.lastName,address:state.address,apartment:state.apartment,orderList:cartItems}});case 20:dispatch(rewriteCart([]));history.push('/');case 22:_context.next=29;break;case 24:_context.prev=24;_context.t0=_context[\"catch\"](2);if(!axios.isAxiosError(_context.t0)){_context.next=29;break;}if(!(_context.t0&&_context.t0.response)){_context.next=29;break;}throw new Error(_context.t0.response.data.message);case 29:case\"end\":return _context.stop();}}},_callee,null,[[2,24]]);}));return function handleClick(_x){return _ref.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(Box,{sx:mainStyle,children:[/*#__PURE__*/_jsx(Link,{to:\"/\",style:{textDecoration:'none',color:'#333333'},children:/*#__PURE__*/_jsx(Typography,{sx:{fontSize:'26px',lineHeight:'1.3em',paddingBottom:'28px'},children:\"Groca\"})}),/*#__PURE__*/_jsx(AccordionComponent,{cartItems:cartItems,totalPrice:totalPrice}),/*#__PURE__*/_jsx(ContactInformation,{handleChange:handleChange,value:state.email,error:state.errorEmail}),/*#__PURE__*/_jsx(ShippingAddress,{state:state,handleChange:handleChange}),isAuth?/*#__PURE__*/_jsx(SaveInformation,{handleCheck:handleCheck,checked:needToSave}):null,/*#__PURE__*/_jsxs(Box,{sx:bottomButtons,children:[/*#__PURE__*/_jsx(CommonButton,{sx:checkoutButtonStyle,onClick:handleClick,children:\"Checkout\"}),/*#__PURE__*/_jsx(Link,{to:\"/cart\",children:\"Return to cart\"})]}),/*#__PURE__*/_jsxs(Box,{sx:{padding:'14px 0px'},children:[/*#__PURE__*/_jsx(Divider,{sx:{marginBottom:'14px'}}),/*#__PURE__*/_jsx(Typography,{sx:{color:'#737373',fontSize:'12px'},children:\"All rights reserved Groca\"})]})]});};export default Main;","map":{"version":3,"sources":["/Users/dcurchin/Desktop/final/grocery-shop-ui/src/components/checkout/Main.jsx"],"names":["Typography","Box","Divider","React","useState","Link","useHistory","ContactInformation","SaveInformation","ShippingAddress","CommonButton","useDispatch","useSelector","emailValidation","axios","anyString255Validation","setIsChecked","setDataInDb","rewriteCart","AccordionComponent","mainStyle","paddingRight","paddingTop","paddingLeft","color","width","display","flexDirection","gap","backgroundColor","bottomButtons","alignItems","marginBottom","textDecoration","justifyContent","content","checkoutButtonStyle","borderRadius","padding","fontSize","textTransform","Main","dispatch","history","auth","state","token","isAuth","checkout","needToSave","email","firstName","lastName","address","apartment","cart","cartItems","getTotalPrice","reducer","acc","item","quantity","price","size","reduce","totalPrice","toFixed","errorEmail","errorFirstName","errorLastName","errorAddress","errorApartment","setState","handleChange","e","target","name","value","handleCheck","checked","handleClick","preventDefault","method","url","headers","Authorization","data","orderList","response","status","push","isAxiosError","Error","message","lineHeight","paddingBottom"],"mappings":"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","sourcesContent":["import { Typography, Box, Divider } from '@mui/material';\r\nimport { React, useState } from 'react';\r\nimport { Link, useHistory } from 'react-router-dom';\r\nimport ContactInformation from './ContactInformation';\r\nimport SaveInformation from './SaveInformation';\r\nimport ShippingAddress from './ShippingAddress';\r\nimport CommonButton from '../common/buttons/CommonButton';\r\nimport { useDispatch, useSelector } from 'react-redux';\r\nimport { emailValidation } from '../../helpers/emailValidation';\r\nimport axios from 'axios';\r\nimport { anyString255Validation } from '../../helpers/anyString255Validation';\r\nimport { setIsChecked, setDataInDb } from '../../redux/slices/checkoutSlice';\r\nimport { rewriteCart } from '../../redux/slices/cartSlice';\r\nimport AccordionComponent from './AccordionComponent';\r\n\r\nconst mainStyle = {\r\n  paddingRight: '4em',\r\n  paddingTop: '4em',\r\n  paddingLeft: '14%',\r\n  color: '#333333',\r\n  width: '55%',\r\n  display: 'flex',\r\n  flexDirection: 'column',\r\n  gap: '12px',\r\n  backgroundColor: '#fff',\r\n  '@media (max-width : 1000px)': {\r\n    width: '100%',\r\n    paddingTop: '1.5em',\r\n    paddingLeft: '15%',\r\n    paddingRight: '15%',\r\n  },\r\n  '@media (max-width: 750px)': {\r\n    display: 'block',\r\n  },\r\n};\r\n\r\nconst bottomButtons = {\r\n  display: 'flex',\r\n  alignItems: 'baseline',\r\n  gap: '18px',\r\n  marginBottom: '4em',\r\n  '& a': {\r\n    textDecoration: 'none',\r\n    color: 'primary.main',\r\n    '@media (max-width: 750px)': {\r\n      paddingTop: '15px',\r\n      width: '100%',\r\n      display: 'flex',\r\n      justifyContent: 'center',\r\n      alignItems: 'center',\r\n      '&::before': {\r\n        content: '\"❮\"',\r\n        paddingRight: '5px',\r\n      },\r\n    },\r\n  },\r\n  '@media (max-width: 750px)': {\r\n    display: 'block',\r\n    marginBottom: '3em',\r\n  },\r\n};\r\n\r\nconst checkoutButtonStyle = {\r\n  borderRadius: '5px',\r\n  color: 'white',\r\n  padding: '14px 24px',\r\n  fontSize: '20px',\r\n  width: '190px',\r\n  textTransform: 'none',\r\n  '&:hover': {\r\n    backgroundColor: 'secondary.main',\r\n  },\r\n  '@media (max-width: 750px)': {\r\n    width: '100%',\r\n  },\r\n};\r\n\r\nconst Main = () => {\r\n  const dispatch = useDispatch();\r\n  const history = useHistory();\r\n\r\n  const auth = useSelector((state) => state.auth);\r\n  const { token, isAuth } = auth;\r\n\r\n  const checkout = useSelector((state) => state.checkout);\r\n  const { needToSave, email, firstName, lastName, address, apartment } =\r\n    checkout;\r\n\r\n  const cart = useSelector((state) => state.cart);\r\n  const { cartItems } = cart;\r\n\r\n  const getTotalPrice = () => {\r\n    const reducer = (acc, item) => acc + item.quantity * item.price * item.size;\r\n    return cartItems.reduce(reducer, 0);\r\n  };\r\n\r\n  let totalPrice = getTotalPrice().toFixed(2);\r\n\r\n  const [state, setState] = useState({\r\n    email: email || '',\r\n    errorEmail: '',\r\n    firstName: firstName || '',\r\n    errorFirstName: '',\r\n    lastName: lastName || '',\r\n    errorLastName: '',\r\n    address: address || '',\r\n    errorAddress: '',\r\n    apartment: apartment || '',\r\n    errorApartment: '',\r\n  });\r\n\r\n  const handleChange = (e) => {\r\n    setState({\r\n      ...state,\r\n      [e.target.name]: e.target.value,\r\n      errorEmail: e.target.name === 'email' ? '' : state.errorEmail,\r\n      errorFirstName: e.target.name === 'firstName' ? '' : state.errorFirstName,\r\n      errorLastName: e.target.name === 'lastName' ? '' : state.errorLastName,\r\n      errorAddress: e.target.name === 'address' ? '' : state.errorAddress,\r\n      errorApartment: e.target.name === 'apartment' ? '' : state.errorApartment,\r\n    });\r\n  };\r\n  const handleCheck = (e) => {\r\n    dispatch(setIsChecked(e.target.checked));\r\n  };\r\n  const handleClick = async (e) => {\r\n    e.preventDefault();\r\n    if (\r\n      emailValidation(state, setState) &&\r\n      anyString255Validation(state, setState, 'firstName', 'errorFirstName') &&\r\n      anyString255Validation(state, setState, 'lastName', 'errorLastName') &&\r\n      anyString255Validation(state, setState, 'address', 'errorAddress') &&\r\n      anyString255Validation(state, setState, 'apartment', 'errorApartment')\r\n    ) {\r\n      try {\r\n        if (isAuth && needToSave) {\r\n          const response = await axios({\r\n            method: 'post',\r\n            url: '/api/checkout',\r\n            headers: {\r\n              Authorization: token,\r\n            },\r\n            data: {\r\n              needToSave: true,\r\n              totalPrice: totalPrice,\r\n              email: state.email,\r\n              firstName: state.firstName,\r\n              lastName: state.lastName,\r\n              address: state.address,\r\n              apartment: state.apartment,\r\n              orderList: cartItems,\r\n            },\r\n          });\r\n\r\n          if (response.status === 201) {\r\n            dispatch(\r\n              setDataInDb({\r\n                needToSave: true,\r\n                email: state.email,\r\n                firstName: state.firstName,\r\n                lastName: state.lastName,\r\n                address: state.address,\r\n                apartment: state.apartment,\r\n              })\r\n            );\r\n            dispatch(rewriteCart([]));\r\n            history.push('/');\r\n          }\r\n        } else if (isAuth && !needToSave) {\r\n          const response = await axios({\r\n            method: 'post',\r\n            url: '/api/checkout',\r\n            headers: {\r\n              Authorization: token,\r\n            },\r\n            data: {\r\n              needToSave: false,\r\n              totalPrice: totalPrice,\r\n              email: state.email,\r\n              firstName: state.firstName,\r\n              lastName: state.lastName,\r\n              address: state.address,\r\n              apartment: state.apartment,\r\n              orderList: cartItems,\r\n            },\r\n          });\r\n\r\n          if (response.status === 201) {\r\n            dispatch(\r\n              setDataInDb({\r\n                needToSave: false,\r\n                email: '',\r\n                firstName: '',\r\n                lastName: '',\r\n                address: '',\r\n                apartment: '',\r\n              })\r\n            );\r\n            dispatch(rewriteCart([]));\r\n            history.push('/');\r\n          }\r\n        } else if (!isAuth) {\r\n          await axios({\r\n            method: 'post',\r\n            url: '/api/checkout',\r\n            data: {\r\n              needToSave: false,\r\n              totalPrice: totalPrice,\r\n              email: state.email,\r\n              firstName: state.firstName,\r\n              lastName: state.lastName,\r\n              address: state.address,\r\n              apartment: state.apartment,\r\n              orderList: cartItems,\r\n            },\r\n          });\r\n          dispatch(rewriteCart([]));\r\n          history.push('/');\r\n        }\r\n      } catch (err) {\r\n        if (axios.isAxiosError(err)) {\r\n          if (err && err.response) {\r\n            throw new Error(err.response.data.message);\r\n          }\r\n        }\r\n      }\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Box sx={mainStyle}>\r\n      <Link\r\n        to=\"/\"\r\n        style={{\r\n          textDecoration: 'none',\r\n          color: '#333333',\r\n        }}\r\n      >\r\n        <Typography\r\n          sx={{ fontSize: '26px', lineHeight: '1.3em', paddingBottom: '28px' }}\r\n        >\r\n          Groca\r\n        </Typography>\r\n      </Link>\r\n\r\n      <AccordionComponent cartItems={cartItems} totalPrice={totalPrice} />\r\n\r\n      <ContactInformation\r\n        handleChange={handleChange}\r\n        value={state.email}\r\n        error={state.errorEmail}\r\n      />\r\n      <ShippingAddress state={state} handleChange={handleChange} />\r\n      {isAuth ? (\r\n        <SaveInformation handleCheck={handleCheck} checked={needToSave} />\r\n      ) : null}\r\n\r\n      <Box sx={bottomButtons}>\r\n        <CommonButton sx={checkoutButtonStyle} onClick={handleClick}>\r\n          Checkout\r\n        </CommonButton>\r\n\r\n        <Link to=\"/cart\">Return to cart</Link>\r\n      </Box>\r\n      <Box sx={{ padding: '14px 0px' }}>\r\n        <Divider sx={{ marginBottom: '14px' }} />\r\n        <Typography sx={{ color: '#737373', fontSize: '12px' }}>\r\n          All rights reserved Groca\r\n        </Typography>\r\n      </Box>\r\n    </Box>\r\n  );\r\n};\r\n\r\nexport default Main;\r\n"]},"metadata":{},"sourceType":"module"}