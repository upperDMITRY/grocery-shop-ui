{"ast":null,"code":"import _regeneratorRuntime from\"/Users/dcurchin/Desktop/final/grocery-shop-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/dcurchin/Desktop/final/grocery-shop-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _defineProperty from\"/Users/dcurchin/Desktop/final/grocery-shop-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _objectSpread from\"/Users/dcurchin/Desktop/final/grocery-shop-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"/Users/dcurchin/Desktop/final/grocery-shop-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{useState}from'react';import{Link,useHistory}from'react-router-dom';import{useSelector,useDispatch}from'react-redux';import axios from'axios';import{Box,Divider,Paper,Typography}from'@mui/material';import LoginInput from'../../components/login/LoginInput';import CommonButton from'../../components/common/buttons/CommonButton';import GreenPageHeader from'./../../components/common/GreenPageHeader';import ButtonSpinner from'../../components/common/ButtonSpinner';import AuthErrorAlert from'../../components/common/AuthErrorAlert';import{emailValidation}from'../../helpers/emailValidation';import{passwordValidation}from'../../helpers/passwordValidation';import{setIsAuth,setError}from'../../redux/slices/authSlice';import{setLoading}from'../../redux/slices/loginSlice';import{pageContainerStyle,formContainerStyle,formStyle,footerLinksStyle}from'../../components/common/styles/loginAndRegistrationStyles';import{rewriteCart}from'../../redux/slices/cartSlice';import jwt_decode from'jwt-decode';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var LoginContainer=function LoginContainer(){var history=useHistory();var dispatch=useDispatch();var loading=useSelector(function(state){return state.login.loading;});var cartItems=useSelector(function(state){return state.cart.cartItems;});var visitorId=useSelector(function(state){return state.auth.visitorId;});var _useState=useState({email:'',password:'',errorEmail:'',errorPassword:''}),_useState2=_slicedToArray(_useState,2),state=_useState2[0],setState=_useState2[1];var handleChange=function handleChange(e){var _objectSpread2;setState(_objectSpread(_objectSpread({},state),{},(_objectSpread2={},_defineProperty(_objectSpread2,e.target.name,e.target.value),_defineProperty(_objectSpread2,\"errorEmail\",e.target.name==='email'?'':state.errorEmail),_defineProperty(_objectSpread2,\"errorPassword\",e.target.name==='password'?'':state.errorPassword),_objectSpread2)));};var email=state.email,password=state.password;var handleClick=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(e){var response,token,decodedToken;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:e.preventDefault();if(!(emailValidation(state,setState)&&passwordValidation(state,setState))){_context.next=16;break;}_context.prev=2;dispatch(setLoading(true));_context.next=6;return axios.post('/api/auth/login',{email:email.toLowerCase(),password:password,cartItems:cartItems,visitorId:visitorId});case 6:response=_context.sent;if(response.status===200){localStorage.setItem('visitorId',visitorId);token=response.data.token;dispatch(setIsAuth({email:response.data.email,token:token,isAuth:true}));decodedToken=jwt_decode(token);if(decodedToken.role==='ADMIN'){history.push('/admin/dashboard');}else{history.push('/');}dispatch(rewriteCart(response.data.cartItems));}_context.next=13;break;case 10:_context.prev=10;_context.t0=_context[\"catch\"](2);if(axios.isAxiosError(_context.t0)){if(_context.t0&&_context.t0.response){dispatch(setError(_context.t0.response.data.message));}}case 13:_context.prev=13;dispatch(setLoading(false));return _context.finish(13);case 16:case\"end\":return _context.stop();}}},_callee,null,[[2,10,13,16]]);}));return function handleClick(_x){return _ref.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(AuthErrorAlert,{}),/*#__PURE__*/_jsx(GreenPageHeader,{title:\"Login\"}),/*#__PURE__*/_jsx(Box,{sx:pageContainerStyle,children:/*#__PURE__*/_jsxs(Paper,{elevation:0,sx:formContainerStyle,children:[/*#__PURE__*/_jsxs(Box,{component:\"form\",sx:formStyle,noValidate:true,autoComplete:\"off\",children:[/*#__PURE__*/_jsx(LoginInput,{label:\"Email\",type:\"email\",autoFocus:true,value:state.email,error:state.errorEmail,handleChange:handleChange}),/*#__PURE__*/_jsx(LoginInput,{label:\"Password\",type:\"password\",value:state.password,error:state.errorPassword,handleChange:handleChange}),/*#__PURE__*/_jsx(Box,{children:/*#__PURE__*/_jsxs(CommonButton,{padding:\"7px 30px\",fontSize:\"16px\",onClick:handleClick,type:\"submit\",disabled:loading,children:['Sign In',loading&&/*#__PURE__*/_jsx(ButtonSpinner,{})]})})]}),/*#__PURE__*/_jsx(Divider,{sx:{marginTop:3}}),/*#__PURE__*/_jsxs(Box,{sx:footerLinksStyle,children:[/*#__PURE__*/_jsx(Link,{to:\"#\",children:/*#__PURE__*/_jsx(Typography,{children:\"Forgot your password?\"})}),/*#__PURE__*/_jsx(Link,{to:\"/account/register\",children:/*#__PURE__*/_jsx(Typography,{children:\"Create account\"})}),/*#__PURE__*/_jsx(Link,{to:\"/\",children:/*#__PURE__*/_jsx(Typography,{children:\"Return to Store\"})})]})]})})]});};export default LoginContainer;","map":{"version":3,"sources":["/Users/dcurchin/Desktop/final/grocery-shop-ui/src/pages/login/LoginContainer.jsx"],"names":["useState","Link","useHistory","useSelector","useDispatch","axios","Box","Divider","Paper","Typography","LoginInput","CommonButton","GreenPageHeader","ButtonSpinner","AuthErrorAlert","emailValidation","passwordValidation","setIsAuth","setError","setLoading","pageContainerStyle","formContainerStyle","formStyle","footerLinksStyle","rewriteCart","jwt_decode","LoginContainer","history","dispatch","loading","state","login","cartItems","cart","visitorId","auth","email","password","errorEmail","errorPassword","setState","handleChange","e","target","name","value","handleClick","preventDefault","post","toLowerCase","response","status","localStorage","setItem","token","data","isAuth","decodedToken","role","push","isAxiosError","message","marginTop"],"mappings":"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","sourcesContent":["import { useState } from 'react';\r\nimport { Link, useHistory } from 'react-router-dom';\r\nimport { useSelector, useDispatch } from 'react-redux';\r\nimport axios from 'axios';\r\nimport { Box, Divider, Paper, Typography } from '@mui/material';\r\nimport LoginInput from '../../components/login/LoginInput';\r\nimport CommonButton from '../../components/common/buttons/CommonButton';\r\nimport GreenPageHeader from './../../components/common/GreenPageHeader';\r\nimport ButtonSpinner from '../../components/common/ButtonSpinner';\r\nimport AuthErrorAlert from '../../components/common/AuthErrorAlert';\r\nimport { emailValidation } from '../../helpers/emailValidation';\r\nimport { passwordValidation } from '../../helpers/passwordValidation';\r\nimport { setIsAuth, setError } from '../../redux/slices/authSlice';\r\nimport { setLoading } from '../../redux/slices/loginSlice';\r\nimport {\r\n  pageContainerStyle,\r\n  formContainerStyle,\r\n  formStyle,\r\n  footerLinksStyle,\r\n} from '../../components/common/styles/loginAndRegistrationStyles';\r\nimport { rewriteCart } from '../../redux/slices/cartSlice';\r\nimport jwt_decode from 'jwt-decode';\r\n\r\nconst LoginContainer = () => {\r\n  const history = useHistory();\r\n  const dispatch = useDispatch();\r\n  const loading = useSelector((state) => state.login.loading);\r\n  const cartItems = useSelector((state) => state.cart.cartItems);\r\n  const visitorId = useSelector((state) => state.auth.visitorId);\r\n\r\n  const [state, setState] = useState({\r\n    email: '',\r\n    password: '',\r\n    errorEmail: '',\r\n    errorPassword: '',\r\n  });\r\n\r\n  const handleChange = (e) => {\r\n    setState({\r\n      ...state,\r\n      [e.target.name]: e.target.value,\r\n      errorEmail: e.target.name === 'email' ? '' : state.errorEmail,\r\n      errorPassword: e.target.name === 'password' ? '' : state.errorPassword,\r\n    });\r\n  };\r\n\r\n  const { email, password } = state;\r\n\r\n  const handleClick = async (e) => {\r\n    e.preventDefault();\r\n\r\n    if (\r\n      emailValidation(state, setState) &&\r\n      passwordValidation(state, setState)\r\n    ) {\r\n      try {\r\n        dispatch(setLoading(true));\r\n\r\n        const response = await axios.post('/api/auth/login', {\r\n          email: email.toLowerCase(),\r\n          password,\r\n          cartItems,\r\n          visitorId,\r\n        });\r\n\r\n        if (response.status === 200) {\r\n          localStorage.setItem('visitorId', visitorId);\r\n          const token = response.data.token;\r\n          dispatch(\r\n            setIsAuth({\r\n              email: response.data.email,\r\n              token,\r\n              isAuth: true,\r\n            })\r\n          );\r\n          const decodedToken = jwt_decode(token);\r\n          if (decodedToken.role === 'ADMIN') {\r\n            history.push('/admin/dashboard');\r\n          } else {\r\n            history.push('/');\r\n          }\r\n\r\n          dispatch(rewriteCart(response.data.cartItems));\r\n        }\r\n      } catch (err) {\r\n        if (axios.isAxiosError(err)) {\r\n          if (err && err.response) {\r\n            dispatch(setError(err.response.data.message));\r\n          }\r\n        }\r\n      } finally {\r\n        dispatch(setLoading(false));\r\n      }\r\n    }\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <AuthErrorAlert />\r\n      <GreenPageHeader title=\"Login\" />\r\n      <Box sx={pageContainerStyle}>\r\n        <Paper elevation={0} sx={formContainerStyle}>\r\n          <Box component=\"form\" sx={formStyle} noValidate autoComplete=\"off\">\r\n            <LoginInput\r\n              label=\"Email\"\r\n              type=\"email\"\r\n              autoFocus={true}\r\n              value={state.email}\r\n              error={state.errorEmail}\r\n              handleChange={handleChange}\r\n            />\r\n            <LoginInput\r\n              label=\"Password\"\r\n              type=\"password\"\r\n              value={state.password}\r\n              error={state.errorPassword}\r\n              handleChange={handleChange}\r\n            />\r\n            <Box>\r\n              <CommonButton\r\n                padding=\"7px 30px\"\r\n                fontSize=\"16px\"\r\n                onClick={handleClick}\r\n                type=\"submit\"\r\n                disabled={loading}\r\n              >\r\n                {'Sign In'}\r\n                {loading && <ButtonSpinner />}\r\n              </CommonButton>\r\n            </Box>\r\n          </Box>\r\n          <Divider sx={{ marginTop: 3 }} />\r\n          <Box sx={footerLinksStyle}>\r\n            <Link to=\"#\">\r\n              <Typography>Forgot your password?</Typography>\r\n            </Link>\r\n            <Link to=\"/account/register\">\r\n              <Typography>Create account</Typography>\r\n            </Link>\r\n            <Link to=\"/\">\r\n              <Typography>Return to Store</Typography>\r\n            </Link>\r\n          </Box>\r\n        </Paper>\r\n      </Box>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default LoginContainer;\r\n"]},"metadata":{},"sourceType":"module"}