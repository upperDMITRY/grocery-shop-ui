{"ast":null,"code":"import { __extends } from \"tslib\";\nimport { Entity } from \"./Entity\";\nimport { TextFormatter } from \"./TextFormatter\";\nimport * as $type from \"./Type\";\nimport * as $utils from \"./Utils\";\n\nvar DateFormatter =\n/** @class */\nfunction (_super) {\n  __extends(DateFormatter, _super);\n\n  function DateFormatter() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n\n  Object.defineProperty(DateFormatter.prototype, \"_setDefaults\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function () {\n      // Defaults\n      this._setDefault(\"capitalize\", true);\n\n      this._setDefault(\"dateFormat\", \"yyyy-MM-dd\");\n\n      _super.prototype._setDefaults.call(this);\n    }\n  });\n  Object.defineProperty(DateFormatter.prototype, \"_beforeChanged\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function () {\n      _super.prototype._beforeChanged.call(this);\n    }\n  });\n  Object.defineProperty(DateFormatter.prototype, \"format\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function (source, format) {\n      // Locale?\n      // TODO\n      // No format passed in or it's empty\n      if (typeof format === \"undefined\" || format === \"\") {\n        format = this.get(\"dateFormat\", \"yyyy-MM-dd\");\n      } // Init return value\n\n\n      var formatted; // Cast?\n      // TODO: decide if we need to cast\n\n      var date = source; // Is it a built-in format or Intl.DateTimeFormat\n\n      if ($type.isObject(format)) {\n        try {\n          var locales = this.get(\"intlLocales\");\n\n          if (locales) {\n            return new Intl.DateTimeFormat(locales, format).format(date);\n          } else {\n            return new Intl.DateTimeFormat(undefined, format).format(date);\n          }\n        } catch (e) {\n          return \"Invalid\";\n        }\n      } // get format info (it will also deal with parser caching)\n\n\n      var info = this.parseFormat(format); // Should we apply custom time zone?\n      // TODO\n      // if (this.timezoneOffset != null) {\n      // \tdate.setMinutes(date.getMinutes() + date.getTimezoneOffset() - this.timezoneOffset);\n      // }\n      // else if (this.timezone != null) {\n      // \tdate = $time.setTimezone(date, this.timezone);\n      // }\n      // Check if it's a valid date\n\n      if (!$type.isNumber(date.getTime())) {\n        // TODO translation\n        //return this._t(\"Invalid date\");\n        return \"Invalid date\";\n      } // Apply format\n\n\n      formatted = this.applyFormat(date, info); // Capitalize\n\n      if (this.get(\"capitalize\")) {\n        formatted = formatted.replace(/^.{1}/, formatted.substr(0, 1).toUpperCase());\n      } // We're done\n\n\n      return formatted;\n    }\n  });\n  /**\r\n   * Applies format to Date.\r\n   *\r\n   * @param date      Date object\r\n   * @param info      Parsed format information\r\n   * @return Formatted date string\r\n   */\n\n  Object.defineProperty(DateFormatter.prototype, \"applyFormat\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function (date, info) {\n      // Init return value\n      var res = info.template; // Get values\n\n      var fullYear,\n          month,\n          weekday,\n          day,\n          hours,\n          minutes,\n          seconds,\n          milliseconds,\n          offset = date.getTimezoneOffset(),\n          timestamp = date.getTime();\n\n      if (this._root.utc) {\n        fullYear = date.getUTCFullYear();\n        month = date.getUTCMonth();\n        weekday = date.getUTCDay();\n        day = date.getUTCDate();\n        hours = date.getUTCHours();\n        minutes = date.getUTCMinutes();\n        seconds = date.getUTCSeconds();\n        milliseconds = date.getUTCMilliseconds();\n      } else {\n        fullYear = date.getFullYear();\n        month = date.getMonth();\n        weekday = date.getDay();\n        day = date.getDate();\n        hours = date.getHours();\n        minutes = date.getMinutes();\n        seconds = date.getSeconds();\n        milliseconds = date.getMilliseconds();\n      } // Go through each part and format/replace it in template\n\n\n      for (var i = 0, len = info.parts.length; i < len; i++) {\n        var value = \"\";\n\n        switch (info.parts[i]) {\n          case \"G\":\n            value = this._t(fullYear < 0 ? \"_era_bc\" : \"_era_ad\");\n            break;\n\n          case \"yyyy\":\n            value = Math.abs(fullYear).toString();\n\n            if (fullYear < 0) {\n              value += this._t(\"_era_bc\");\n            }\n\n            break;\n\n          case \"yyy\":\n          case \"yy\":\n          case \"y\":\n            value = Math.abs(fullYear).toString().substr(-info.parts[i].length);\n\n            if (fullYear < 0) {\n              value += this._t(\"_era_bc\");\n            }\n\n            break;\n\n          case \"YYYY\":\n          case \"YYY\":\n          case \"YY\":\n          case \"Y\":\n            var week = $utils.getWeek(date);\n            var year = fullYear;\n\n            if (week == 1 && weekday > 4) {\n              year--;\n            }\n\n            if (info.parts[i] == \"YYYY\") {\n              value = Math.abs(year).toString();\n            } else {\n              value = Math.abs(year).toString().substr(-info.parts[i].length);\n            }\n\n            if (year < 0) {\n              value += this._t(\"_era_bc\");\n            }\n\n            break;\n\n          case \"u\":\n            // @todo\n            break;\n\n          case \"q\":\n            value = \"\" + Math.ceil((date.getMonth() + 1) / 3);\n            break;\n\n          case \"MMMMM\":\n            value = this._t(this._getMonth(month)).substr(0, 1);\n            break;\n\n          case \"MMMM\":\n            value = this._t(this._getMonth(month));\n            break;\n\n          case \"MMM\":\n            value = this._t(this._getShortMonth(month));\n            break;\n\n          case \"MM\":\n            value = $utils.padString(month + 1, 2, \"0\");\n            break;\n\n          case \"M\":\n            value = (month + 1).toString();\n            break;\n\n          case \"ww\":\n            value = $utils.padString($utils.getWeek(date, this._root.utc), 2, \"0\");\n            break;\n\n          case \"w\":\n            value = $utils.getWeek(date, this._root.utc).toString();\n            break;\n\n          case \"W\":\n            value = $utils.getMonthWeek(date, this._root.utc).toString();\n            break;\n\n          case \"dd\":\n            value = $utils.padString(day, 2, \"0\");\n            break;\n\n          case \"d\":\n            value = day.toString();\n            break;\n\n          case \"DD\":\n          case \"DDD\":\n            value = $utils.padString($utils.getYearDay(date, this._root.utc).toString(), info.parts[i].length, \"0\");\n            break;\n\n          case \"D\":\n            value = $utils.getYearDay(date, this._root.utc).toString();\n            break;\n\n          case \"F\":\n            // @todo\n            break;\n\n          case \"g\":\n            // @todo\n            break;\n\n          case \"t\":\n            value = this._root.language.translateFunc(\"_dateOrd\").call(this, day);\n            break;\n\n          case \"E\":\n            value = (weekday || 7).toString();\n            break;\n\n          case \"EE\":\n            value = $utils.padString((weekday || 7).toString(), 2, \"0\");\n            break;\n\n          case \"EEE\":\n          case \"eee\":\n            value = this._t(this._getShortWeekday(weekday));\n            break;\n\n          case \"EEEE\":\n          case \"eeee\":\n            value = this._t(this._getShortWeekday(weekday));\n            break;\n\n          case \"EEEEE\":\n          case \"eeeee\":\n            value = this._t(this._getShortWeekday(weekday)).substr(0, 1);\n            break;\n\n          case \"e\":\n          case \"ee\":\n            value = (weekday - (this._root.locale.firstDayOfWeek || 1) + 1).toString();\n\n            if (info.parts[i] == \"ee\") {\n              value = $utils.padString(value, 2, \"0\");\n            }\n\n            break;\n\n          case \"a\":\n            if (hours >= 12) {\n              value = this._t(\"PM\");\n            } else {\n              value = this._t(\"AM\");\n            }\n\n            break;\n\n          case \"aa\":\n            if (hours >= 12) {\n              value = this._t(\"P.M.\");\n            } else {\n              value = this._t(\"A.M.\");\n            }\n\n            break;\n\n          case \"aaa\":\n            if (hours >= 12) {\n              value = this._t(\"P\");\n            } else {\n              value = this._t(\"A\");\n            }\n\n            break;\n\n          case \"h\":\n            value = $utils.get12Hours(hours).toString();\n            break;\n\n          case \"hh\":\n            value = $utils.padString($utils.get12Hours(hours), 2, \"0\");\n            break;\n\n          case \"H\":\n            value = hours.toString();\n            break;\n\n          case \"HH\":\n            value = $utils.padString(hours, 2, \"0\");\n            break;\n\n          case \"K\":\n            value = $utils.get12Hours(hours, 0).toString();\n            break;\n\n          case \"KK\":\n            value = $utils.padString($utils.get12Hours(hours, 0), 2, \"0\");\n            break;\n\n          case \"k\":\n            value = (hours + 1).toString();\n            break;\n\n          case \"kk\":\n            value = $utils.padString(hours + 1, 2, \"0\");\n            break;\n\n          case \"m\":\n            value = minutes.toString();\n            break;\n\n          case \"mm\":\n            value = $utils.padString(minutes, 2, \"0\");\n            break;\n\n          case \"s\":\n            value = seconds.toString();\n            break;\n\n          case \"ss\":\n            value = $utils.padString(seconds, 2, \"0\");\n            break;\n\n          case \"S\":\n          case \"SS\":\n          case \"SSS\":\n            value = Math.round(milliseconds / 1000 * Math.pow(10, info.parts[i].length)).toString();\n            break;\n\n          case \"x\":\n            value = timestamp.toString();\n            break;\n\n          case \"n\":\n          case \"nn\":\n          case \"nnn\":\n            value = $utils.padString(milliseconds, info.parts[i].length, \"0\");\n            break;\n\n          case \"z\":\n            value = $utils.getTimeZone(date, false, false, this._root.utc);\n            break;\n\n          case \"zz\":\n            value = $utils.getTimeZone(date, true, false, this._root.utc);\n            break;\n\n          case \"zzz\":\n            value = $utils.getTimeZone(date, false, true, this._root.utc);\n            break;\n\n          case \"zzzz\":\n            value = $utils.getTimeZone(date, true, true, this._root.utc);\n            break;\n\n          case \"Z\":\n          case \"ZZ\":\n            var tz = Math.abs(offset) / 60;\n            var tzh = Math.floor(tz);\n            var tzm = tz * 60 - tzh * 60;\n\n            if (this._root.utc) {\n              tzh = 0;\n              tzm = 0;\n            }\n\n            if (info.parts[i] == \"Z\") {\n              value = \"GMT\";\n              value += offset > 0 ? \"-\" : \"+\";\n              value += $utils.padString(tzh, 2) + \":\" + $utils.padString(tzm, 2);\n            } else {\n              value = offset > 0 ? \"-\" : \"+\";\n              value += $utils.padString(tzh, 2) + $utils.padString(tzm, 2);\n            }\n\n            break;\n\n          case \"i\":\n            value = date.toISOString();\n            break;\n\n          case \"I\":\n            value = date.toUTCString();\n            break;\n        }\n\n        res = res.replace($type.PLACEHOLDER, value);\n      }\n\n      return res;\n    }\n  });\n  /**\r\n   * Parses format into structured infromation.\r\n   *\r\n   * @param format Format template\r\n   */\n\n  Object.defineProperty(DateFormatter.prototype, \"parseFormat\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function (format) {\n      // Check cache\n      // TODO: implement caching of the parsed format\n      // Init format parse info holder\n      var info = {\n        \"template\": \"\",\n        \"parts\": []\n      }; // Let TextFormatter split into chunks\n\n      var chunks = TextFormatter.chunk(format, true);\n\n      for (var i = 0; i < chunks.length; i++) {\n        var chunk = chunks[i];\n\n        if (chunk.type === \"value\") {\n          // Just \"Date\"?\n          if (chunk.text.match(/^date$/i)) {\n            var dateFormat = this.get(\"dateFormat\", \"yyyy-MM-dd\");\n\n            if (!$type.isString(dateFormat)) {\n              dateFormat = \"yyyy-MM-dd\";\n            }\n\n            chunk.text = dateFormat;\n          } // Find all possible parts\n\n\n          var matches = chunk.text.match(/G|yyyy|yyy|yy|y|YYYY|YYY|YY|Y|u|q|MMMMM|MMMM|MMM|MM|M|ww|w|W|dd|d|DDD|DD|D|F|g|EEEEE|EEEE|EEE|EE|E|eeeee|eeee|eee|ee|e|aaa|aa|a|hh|h|HH|H|KK|K|kk|k|mm|m|ss|s|SSS|SS|S|A|zzzz|zzz|zz|z|ZZ|Z|t|x|nnn|nn|n|i|I/g); // Found?\n\n          if (matches) {\n            // Populate template\n            for (var x = 0; x < matches.length; x++) {\n              info.parts.push(matches[x]);\n              chunk.text = chunk.text.replace(matches[x], $type.PLACEHOLDER);\n            }\n          }\n        } // Apply to template\n\n\n        info.template += chunk.text;\n      } // Save cache\n      // TODO\n\n\n      return info;\n    }\n  });\n  Object.defineProperty(DateFormatter.prototype, \"_months\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function () {\n      return [\"January\", \"February\", \"March\", \"April\", \"May\", \"June\", \"July\", \"August\", \"September\", \"October\", \"November\", \"December\"];\n    }\n  });\n  Object.defineProperty(DateFormatter.prototype, \"_getMonth\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function (index) {\n      return this._months()[index];\n    }\n  });\n  Object.defineProperty(DateFormatter.prototype, \"_shortMonths\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function () {\n      return [\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"May(short)\", \"Jun\", \"Jul\", \"Aug\", \"Sep\", \"Oct\", \"Nov\", \"Dec\"];\n    }\n  });\n  Object.defineProperty(DateFormatter.prototype, \"_getShortMonth\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function (index) {\n      return this._shortMonths()[index];\n    }\n  });\n  Object.defineProperty(DateFormatter.prototype, \"_weekdays\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function () {\n      return [\"Sunday\", \"Monday\", \"Tuesday\", \"Wednesday\", \"Thursday\", \"Friday\", \"Saturday\"];\n    }\n  });\n  Object.defineProperty(DateFormatter.prototype, \"_getWeekday\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function (index) {\n      return this._weekdays()[index];\n    }\n  });\n  Object.defineProperty(DateFormatter.prototype, \"_shortWeekdays\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function () {\n      return [\"Sun\", \"Mon\", \"Tue\", \"Wed\", \"Thu\", \"Fri\", \"Sat\"];\n    }\n  });\n  Object.defineProperty(DateFormatter.prototype, \"_getShortWeekday\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function (index) {\n      return this._shortWeekdays()[index];\n    }\n  });\n  Object.defineProperty(DateFormatter.prototype, \"parse\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function (source, format) {\n      // Is it already a Date\n      if (source instanceof Date) {\n        return source;\n      } // Is it a numeric timestamp\n\n\n      if ($type.isNumber(source)) {\n        return new Date(source);\n      } // No? Let's check if it's string, and try converting to it if nec\n\n\n      if (!$type.isString(source)) {\n        source = source.toString();\n      } // Init return value\n\n\n      var res; // Init RegEx for parsing\n\n      var reg = \"\"; // Clean format\n\n      format = $utils.cleanFormat(format); // Clip format to length of the source string\n\n      format = format.substr(0, source.length); // Parse format\n\n      var info = this.parseFormat(format); // Init parsed items holder\n\n      var parsedIndexes = {\n        \"year\": -1,\n        \"year3\": -1,\n        \"year2\": -1,\n        \"year1\": -1,\n        \"month\": -1,\n        \"monthShort\": -1,\n        \"monthLong\": -1,\n        \"weekdayShort\": -1,\n        \"weekdayLong\": -1,\n        \"day\": -1,\n        \"yearDay\": -1,\n        \"week\": -1,\n        \"hourBase0\": -1,\n        \"hour12Base0\": -1,\n        \"hourBase1\": -1,\n        \"hour12Base1\": -1,\n        \"minute\": -1,\n        \"second\": -1,\n        \"millisecond\": -1,\n        \"millisecondDigits\": -1,\n        \"am\": -1,\n        \"zone\": -1,\n        \"timestamp\": -1,\n        \"iso\": -1\n      }; // Init values\n\n      var resValues = {\n        \"year\": 1970,\n        \"month\": 0,\n        \"day\": 1,\n        \"hour\": 0,\n        \"minute\": 0,\n        \"second\": 0,\n        \"millisecond\": 0,\n        \"timestamp\": null,\n        \"offset\": 0,\n        \"utc\": this._root.utc\n      }; // Index adjuster\n\n      var indexAdjust = 0;\n      var index = 0; // Iterate through all of the parts\n\n      for (var i = 0; i < info.parts.length; i++) {\n        // Set current match index\n        index = i + indexAdjust + 1;\n\n        switch (info.parts[i]) {\n          case \"yyyy\":\n          case \"YYYY\":\n            reg += \"([0-9]{4})\";\n            parsedIndexes.year = index;\n            break;\n\n          case \"yyy\":\n          case \"YYY\":\n            reg += \"([0-9]{3})\";\n            parsedIndexes.year3 = index;\n            break;\n\n          case \"yy\":\n          case \"YY\":\n            reg += \"([0-9]{2})\";\n            parsedIndexes.year2 = index;\n            break;\n\n          case \"y\":\n          case \"Y\":\n            reg += \"([0-9]{1})\";\n            parsedIndexes.year1 = index;\n            break;\n\n          case \"MMMM\":\n            reg += \"(\" + this.getStringList(this._months()).join(\"|\") + \")\";\n            parsedIndexes.monthLong = index;\n            break;\n\n          case \"MMM\":\n            reg += \"(\" + this.getStringList(this._shortMonths()).join(\"|\") + \")\";\n            parsedIndexes.monthShort = index;\n            break;\n\n          case \"MM\":\n          case \"M\":\n            reg += \"([0-9]{2}|[0-9]{1})\";\n            parsedIndexes.month = index;\n            break;\n\n          case \"ww\":\n          case \"w\":\n            reg += \"([0-9]{2}|[0-9]{1})\";\n            parsedIndexes.week = index;\n            break;\n\n          case \"dd\":\n          case \"d\":\n            reg += \"([0-9]{2}|[0-9]{1})\";\n            parsedIndexes.day = index;\n            break;\n\n          case \"DDD\":\n          case \"DD\":\n          case \"D\":\n            reg += \"([0-9]{3}|[0-9]{2}|[0-9]{1})\";\n            parsedIndexes.yearDay = index;\n            break;\n\n          case \"dddd\":\n            reg += \"(\" + this.getStringList(this._weekdays()).join(\"|\") + \")\";\n            parsedIndexes.weekdayLong = index;\n            break;\n\n          case \"ddd\":\n            reg += \"(\" + this.getStringList(this._shortWeekdays()).join(\"|\") + \")\";\n            parsedIndexes.weekdayShort = index;\n            break;\n\n          case \"aaa\":\n          case \"aa\":\n          case \"a\":\n            // TODO: fix (escape regex)\n            reg += \"(\" + this.getStringList([\"AM\", \"PM\", \"A\\.M\\.\", \"P\\.M\\.\", \"A\", \"P\"]).join(\"|\") + \")\";\n            parsedIndexes.am = index;\n            break;\n\n          case \"hh\":\n          case \"h\":\n            reg += \"([0-9]{2}|[0-9]{1})\";\n            parsedIndexes.hour12Base1 = index;\n            break;\n\n          case \"HH\":\n          case \"H\":\n            reg += \"([0-9]{2}|[0-9]{1})\";\n            parsedIndexes.hourBase0 = index;\n            break;\n\n          case \"KK\":\n          case \"K\":\n            reg += \"([0-9]{2}|[0-9]{1})\";\n            parsedIndexes.hour12Base0 = index;\n            break;\n\n          case \"kk\":\n          case \"k\":\n            reg += \"([0-9]{2}|[0-9]{1})\";\n            parsedIndexes.hourBase1 = index;\n            break;\n\n          case \"mm\":\n          case \"m\":\n            reg += \"([0-9]{2}|[0-9]{1})\";\n            parsedIndexes.minute = index;\n            break;\n\n          case \"ss\":\n          case \"s\":\n            reg += \"([0-9]{2}|[0-9]{1})\";\n            parsedIndexes.second = index;\n            break;\n\n          case \"SSS\":\n          case \"SS\":\n          case \"S\":\n            reg += \"([0-9]{3}|[0-9]{2}|[0-9]{1})\";\n            parsedIndexes.millisecond = index;\n            parsedIndexes.millisecondDigits = info.parts[i].length;\n            break;\n\n          case \"nnn\":\n          case \"nn\":\n          case \"n\":\n            reg += \"([0-9]{3}|[0-9]{2}|[0-9]{1})\";\n            parsedIndexes.millisecond = index;\n            break;\n\n          case \"x\":\n            reg += \"([0-9]{1,})\";\n            parsedIndexes.timestamp = index;\n            break;\n\n          case \"Z\":\n            reg += \"GMT([-+]+[0-9]{2}:[0-9]{2})\";\n            parsedIndexes.zone = index;\n            break;\n\n          case \"ZZ\":\n            reg += \"([\\\\-+]+[0-9]{2}[0-9]{2})\";\n            parsedIndexes.zone = index;\n            break;\n\n          case \"i\":\n            reg += \"([0-9]{4})-?([0-9]{2})-?([0-9]{2})T?([0-9]{2}):?([0-9]{2}):?([0-9]{2})\\.?([0-9]{0,3})([zZ]|[+\\-][0-9]{2}:?[0-9]{2}|$)\";\n            parsedIndexes.iso = index;\n            indexAdjust += 7;\n            break;\n\n          case \"G\":\n          case \"YYYY\":\n          case \"YYY\":\n          case \"YY\":\n          case \"Y\":\n          case \"MMMMM\":\n          case \"W\":\n          case \"EEEEE\":\n          case \"EEEE\":\n          case \"EEE\":\n          case \"EE\":\n          case \"E\":\n          case \"eeeee\":\n          case \"eeee\":\n          case \"eee\":\n          case \"ee\":\n          case \"e\":\n          case \"zzzz\":\n          case \"zzz\":\n          case \"zz\":\n          case \"z\":\n          case \"t\":\n            // Ignore\n            indexAdjust--;\n            break;\n        }\n\n        reg += \"[^0-9]*\";\n      } // Try matching\n\n\n      var regex = new RegExp(reg);\n      var matches = source.match(regex);\n\n      if (matches) {\n        // Populate the date object\n        // Full year\n        if (parsedIndexes.year > -1) {\n          resValues.year = parseInt(matches[parsedIndexes.year]);\n        } // 3-digit year\n\n\n        if (parsedIndexes.year3 > -1) {\n          var val = parseInt(matches[parsedIndexes.year3]);\n          val += 1000;\n          resValues.year = val;\n        } // 2-digit year\n\n\n        if (parsedIndexes.year2 > -1) {\n          var val = parseInt(matches[parsedIndexes.year2]);\n\n          if (val > 50) {\n            val += 1000;\n          } else {\n            val += 2000;\n          }\n\n          resValues.year = val;\n        } // 1-digit year\n\n\n        if (parsedIndexes.year1 > -1) {\n          var val = parseInt(matches[parsedIndexes.year1]);\n          val = Math.floor(new Date().getFullYear() / 10) * 10 + val;\n          resValues.year = val;\n        } // Full month\n\n\n        if (parsedIndexes.monthLong > -1) {\n          resValues.month = this.resolveMonth(matches[parsedIndexes.monthLong]);\n        } // Short month\n\n\n        if (parsedIndexes.monthShort > -1) {\n          resValues.month = this.resolveShortMonth(matches[parsedIndexes.monthShort]);\n        } // Numeric month\n\n\n        if (parsedIndexes.month > -1) {\n          resValues.month = parseInt(matches[parsedIndexes.month]) - 1;\n        } // Weekday\n        // @todo\n        // Week\n\n\n        if (parsedIndexes.week > -1 && parsedIndexes.day === -1) {\n          // We parse weeks ONLY if day is not explicitly set\n          // TODO: this needs work\n          // (but maybe later - I can hardly imagine anyone passing their dates in weeks)\n          resValues.month = 0;\n          resValues.day = $utils.getDayFromWeek(parseInt(matches[parsedIndexes.week]), resValues.year, 1, this._root.utc);\n        } // Day\n\n\n        if (parsedIndexes.day > -1) {\n          resValues.day = parseInt(matches[parsedIndexes.day]);\n        } // Year day\n\n\n        if (parsedIndexes.yearDay > -1) {\n          resValues.month = 0;\n          resValues.day = parseInt(matches[parsedIndexes.yearDay]);\n        } // 24 Hour (0-23)\n\n\n        if (parsedIndexes.hourBase0 > -1) {\n          resValues.hour = parseInt(matches[parsedIndexes.hourBase0]);\n        } // 24 Hour (1-24)\n\n\n        if (parsedIndexes.hourBase1 > -1) {\n          resValues.hour = parseInt(matches[parsedIndexes.hourBase1]) - 1;\n        } // 12 Hour (0-11)\n\n\n        if (parsedIndexes.hour12Base0 > -1) {\n          var val = parseInt(matches[parsedIndexes.hour12Base0]);\n\n          if (val == 11) {\n            val = 0;\n          }\n\n          if (parsedIndexes.am > -1 && !this.isAm(matches[parsedIndexes.am])) {\n            val += 12;\n          }\n\n          resValues.hour = val;\n        } // 12 Hour (1-12)\n\n\n        if (parsedIndexes.hour12Base1 > -1) {\n          var val = parseInt(matches[parsedIndexes.hour12Base1]);\n\n          if (val == 12) {\n            val = 0;\n          }\n\n          if (parsedIndexes.am > -1 && !this.isAm(matches[parsedIndexes.am])) {\n            val += 12;\n          }\n\n          resValues.hour = val;\n        } // Minute\n\n\n        if (parsedIndexes.minute > -1) {\n          resValues.minute = parseInt(matches[parsedIndexes.minute]);\n        } // Second\n\n\n        if (parsedIndexes.second > -1) {\n          resValues.second = parseInt(matches[parsedIndexes.second]);\n        } // Millisecond\n\n\n        if (parsedIndexes.millisecond > -1) {\n          var val = parseInt(matches[parsedIndexes.millisecond]);\n\n          if (parsedIndexes.millisecondDigits == 2) {\n            val *= 10;\n          } else if (parsedIndexes.millisecondDigits == 1) {\n            val *= 100;\n          }\n\n          resValues.millisecond = val;\n        } // Timestamp\n\n\n        if (parsedIndexes.timestamp > -1) {\n          resValues.timestamp = parseInt(matches[parsedIndexes.timestamp]);\n          var ts = new Date(resValues.timestamp);\n          resValues.year = ts.getUTCFullYear();\n          resValues.month = ts.getUTCMonth();\n          resValues.day = ts.getUTCDate();\n          resValues.hour = ts.getUTCHours();\n          resValues.minute = ts.getUTCMinutes();\n          resValues.second = ts.getUTCSeconds();\n          resValues.millisecond = ts.getUTCMilliseconds();\n        } // Adjust time zone\n\n\n        if (parsedIndexes.zone > -1) {\n          resValues.offset = this.resolveTimezoneOffset(new Date(resValues.year, resValues.month, resValues.day), matches[parsedIndexes.zone]);\n        } // ISO\n\n\n        if (parsedIndexes.iso > -1) {\n          resValues.year = $type.toNumber(matches[parsedIndexes.iso + 0]);\n          resValues.month = $type.toNumber(matches[parsedIndexes.iso + 1]) - 1;\n          resValues.day = $type.toNumber(matches[parsedIndexes.iso + 2]);\n          resValues.hour = $type.toNumber(matches[parsedIndexes.iso + 3]);\n          resValues.minute = $type.toNumber(matches[parsedIndexes.iso + 4]);\n          resValues.second = $type.toNumber(matches[parsedIndexes.iso + 5]);\n          resValues.millisecond = $type.toNumber(matches[parsedIndexes.iso + 6]);\n\n          if (matches[parsedIndexes.iso + 7] == \"Z\" || matches[parsedIndexes.iso + 7] == \"z\") {\n            resValues.utc = true;\n          } else if (matches[parsedIndexes.iso + 7] != \"\") {\n            resValues.offset = this.resolveTimezoneOffset(new Date(resValues.year, resValues.month, resValues.day), matches[parsedIndexes.iso + 7]);\n          }\n        } // Create Date object\n\n\n        if (resValues.utc) {\n          res = new Date(Date.UTC(resValues.year, resValues.month, resValues.day, resValues.hour, resValues.minute, resValues.second, resValues.millisecond));\n        } else {\n          res = new Date(resValues.year, resValues.month, resValues.day, resValues.hour, resValues.minute + resValues.offset, resValues.second, resValues.millisecond);\n        }\n      } else {\n        // Didn't match anything\n        // Let's try dropping it into Date constructor and hope for the best\n        res = new Date(source);\n      }\n\n      return res;\n    }\n  });\n  Object.defineProperty(DateFormatter.prototype, \"resolveTimezoneOffset\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function (date, zone) {\n      var value = zone.match(/([+\\-]?)([0-9]{2}):?([0-9]{2})/);\n\n      if (value) {\n        var match = zone.match(/([+\\-]?)([0-9]{2}):?([0-9]{2})/);\n        var dir = match[1];\n        var hour = match[2];\n        var minute = match[3];\n        var offset = parseInt(hour) * 60 + parseInt(minute); // Adjust offset\n        // Making it negative does not seem to make sense, but it's right\n        // because of how JavaScript calculates GMT offsets\n\n        if (dir == \"+\") {\n          offset *= -1;\n        } // Check the difference in offset\n\n\n        var originalOffset = (date || new Date()).getTimezoneOffset();\n        var diff = offset - originalOffset;\n        return diff;\n      }\n\n      return 0;\n    }\n  });\n  /**\r\n   * Resolves month name (i.e. \"December\") into a month number (11).\r\n   *\r\n   * @param value  Month name\r\n   * @return Month number\r\n   */\n\n  Object.defineProperty(DateFormatter.prototype, \"resolveMonth\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function (value) {\n      // Let's try English first\n      var month = this._months().indexOf(value);\n\n      if (month > -1) {\n        return month;\n      } // Try the translation\n\n\n      if (!this._root.language.isDefault()) {\n        month = this._root.language.translateAll(this._months()).indexOf(value);\n\n        if (month > -1) {\n          return month;\n        }\n      }\n\n      return 0;\n    }\n  });\n  /**\r\n   * Resolves short month name (i.e. \"Dec\") into a month number.\r\n   *\r\n   * @param value  Short month name\r\n   * @return Month number\r\n   */\n\n  Object.defineProperty(DateFormatter.prototype, \"resolveShortMonth\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function (value) {\n      // Let's try English first\n      var month = this._shortMonths().indexOf(value);\n\n      if (month > -1) {\n        return month;\n      } // Maybe long month (workaround for May)\n\n\n      month = this._months().indexOf(value);\n\n      if (month > -1) {\n        return month;\n      } // Try the translation\n\n\n      if (this._root.language && !this._root.language.isDefault()) {\n        month = this._root.language.translateAll(this._shortMonths()).indexOf(value);\n\n        if (month > -1) {\n          return month;\n        }\n      }\n\n      return 0;\n    }\n  });\n  /**\r\n   * Checks if passed in string represents AM/PM notation in many of its\r\n   * versions.\r\n   *\r\n   * @param value  Source string\r\n   * @return Is it AM/PM?\r\n   */\n\n  Object.defineProperty(DateFormatter.prototype, \"isAm\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function (value) {\n      var list = this.getStringList([\"AM\", \"A.M.\", \"A\"]);\n      return list.indexOf(value.toUpperCase()) > -1;\n    }\n  });\n  /**\r\n   * Translates list of strings.\r\n   *\r\n   * @param list  Source strings\r\n   * @return Translated strings\r\n   */\n\n  Object.defineProperty(DateFormatter.prototype, \"getStringList\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function (list) {\n      var res = [];\n\n      for (var i = 0; i < list.length; i++) {\n        // translate?\n        if (this._root.language) {\n          res.push($utils.escapeForRgex(this._t(list[i])));\n        } else {\n          res.push($utils.escapeForRgex(list[i]));\n        }\n      }\n\n      return res;\n    }\n  });\n  return DateFormatter;\n}(Entity);\n\nexport { DateFormatter };","map":{"version":3,"sources":["../../../../../src/.internal/core/util/DateFormatter.ts"],"names":[],"mappings":"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","sourcesContent":["import type { ILocaleSettings } from \"./Language\"\n\nimport { Entity, IEntitySettings, IEntityPrivate } from \"./Entity\"\nimport { TextFormatter } from \"./TextFormatter\"\n\nimport * as $type from \"./Type\"\nimport * as $utils from \"./Utils\";\n\n/**\n * Interface describing parsed date format definition.\n *\n * @ignore\n */\nexport interface DateFormatInfo {\n\t\"template\": string;\n\t\"parts\": any[];\n}\n\nexport interface IDateFormatterSettings extends IEntitySettings {\n\n\t/**\n\t * Should the first letter of the formatted date be capitalized?\n\t *\n\t * @default true\n\t */\n\tcapitalize?: boolean;\n\n\t/**\n\t * A date format to be used when formatting dates.\n\t * \n\t * @see {@link https://www.amcharts.com/docs/v5/concepts/formatters/formatting-dates/} for more info\n\t */\n\tdateFormat?: string | Intl.DateTimeFormatOptions;\n\n\t/**\n\t * An array of data fields that hold date values and should be formatted\n\t * with a [[DateFormatter]].\n\t *\n\t * @see {@link https://www.amcharts.com/docs/v5/concepts/formatters/data-placeholders/#Formatting_placeholders} for more info\n\t */\n\tdateFields?: string[];\n\n\t/**\n\t * Locales to use when formatting using `Intl.DateFormatter`.\n\t */\n\tintlLocales?: string;\n\n}\n\nexport interface IDateFormatterPrivate extends IEntityPrivate {\n}\n\ntype Months = \"January\" | \"February\" | \"March\" | \"April\" | \"May\" | \"June\" | \"July\" | \"August\" | \"September\" | \"October\" | \"November\" | \"December\";\ntype ShortMonths = \"Jan\" | \"Feb\" | \"Mar\" | \"Apr\" | \"May(short)\" | \"Jun\" | \"Jul\" | \"Aug\" | \"Sep\" | \"Oct\" | \"Nov\" | \"Dec\";\ntype Weekdays = \"Sunday\" | \"Monday\" | \"Tuesday\" | \"Wednesday\" | \"Thursday\" | \"Friday\" | \"Saturday\";\ntype ShortWeekdays = \"Sun\" | \"Mon\" | \"Tue\" | \"Wed\" | \"Thu\" | \"Fri\" | \"Sat\";\n\nexport class DateFormatter extends Entity {\n\tdeclare public _settings: IDateFormatterSettings;\n\tdeclare public _privateSettings: IDateFormatterPrivate;\n\n\tprotected _setDefaults() {\n\t\t// Defaults\n\t\tthis._setDefault(\"capitalize\", true);\n\t\tthis._setDefault(\"dateFormat\", \"yyyy-MM-dd\");\n\n\t\tsuper._setDefaults();\n\t}\n\n\tpublic _beforeChanged() {\n\t\tsuper._beforeChanged();\n\t}\n\n\tpublic format(source: any, format?: string | Intl.DateTimeFormatOptions): string {\n\n\t\t// Locale?\n\t\t// TODO\n\n\t\t// No format passed in or it's empty\n\t\tif (typeof format === \"undefined\" || format === \"\") {\n\t\t\tformat = this.get(\"dateFormat\", \"yyyy-MM-dd\");\n\t\t}\n\n\t\t// Init return value\n\t\tlet formatted;\n\n\t\t// Cast?\n\t\t// TODO: decide if we need to cast\n\t\tlet date: Date = source;\n\n\t\t// Is it a built-in format or Intl.DateTimeFormat\n\t\tif ($type.isObject(format)) {\n\n\t\t\ttry {\n\t\t\t\tconst locales = this.get(\"intlLocales\");\n\t\t\t\tif (locales) {\n\t\t\t\t\treturn new Intl.DateTimeFormat(locales, <Intl.DateTimeFormatOptions>format).format(date);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\treturn new Intl.DateTimeFormat(undefined, <Intl.DateTimeFormatOptions>format).format(date);\n\t\t\t\t}\n\t\t\t}\n\t\t\tcatch (e) {\n\t\t\t\treturn \"Invalid\";\n\t\t\t}\n\n\t\t}\n\n\t\t// get format info (it will also deal with parser caching)\n\t\tlet info = this.parseFormat(format);\n\n\t\t// Should we apply custom time zone?\n\t\t// TODO\n\t\t// if (this.timezoneOffset != null) {\n\t\t// \tdate.setMinutes(date.getMinutes() + date.getTimezoneOffset() - this.timezoneOffset);\n\t\t// }\n\t\t// else if (this.timezone != null) {\n\t\t// \tdate = $time.setTimezone(date, this.timezone);\n\t\t// }\n\n\t\t// Check if it's a valid date\n\t\tif (!$type.isNumber(date.getTime())) {\n\t\t\t// TODO translation\n\t\t\t//return this._t(\"Invalid date\");\n\t\t\treturn \"Invalid date\";\n\t\t}\n\n\t\t// Apply format\n\t\tformatted = this.applyFormat(date, info);\n\n\t\t// Capitalize\n\t\tif (this.get(\"capitalize\")) {\n\t\t\tformatted = formatted.replace(\n\t\t\t\t/^.{1}/, formatted.substr(0, 1).toUpperCase()\n\t\t\t);\n\t\t}\n\n\t\t// We're done\n\t\treturn formatted;\n\t}\n\n\t/**\n\t * Applies format to Date.\n\t *\n\t * @param date      Date object\n\t * @param info      Parsed format information\n\t * @return Formatted date string\n\t */\n\tprotected applyFormat(date: Date, info: DateFormatInfo): string {\n\n\t\t// Init return value\n\t\tlet res = info.template;\n\n\t\t// Get values\n\t\tlet fullYear: number,\n\t\t\tmonth: number,\n\t\t\tweekday: number,\n\t\t\tday: number,\n\t\t\thours: number,\n\t\t\tminutes: number,\n\t\t\tseconds: number,\n\t\t\tmilliseconds: number,\n\t\t\toffset: number = date.getTimezoneOffset(),\n\t\t\ttimestamp: number = date.getTime();\n\t\tif (this._root.utc) {\n\t\t\tfullYear = date.getUTCFullYear();\n\t\t\tmonth = date.getUTCMonth();\n\t\t\tweekday = date.getUTCDay();\n\t\t\tday = date.getUTCDate();\n\t\t\thours = date.getUTCHours();\n\t\t\tminutes = date.getUTCMinutes();\n\t\t\tseconds = date.getUTCSeconds();\n\t\t\tmilliseconds = date.getUTCMilliseconds();\n\t\t}\n\t\telse {\n\t\t\tfullYear = date.getFullYear();\n\t\t\tmonth = date.getMonth();\n\t\t\tweekday = date.getDay();\n\t\t\tday = date.getDate();\n\t\t\thours = date.getHours();\n\t\t\tminutes = date.getMinutes();\n\t\t\tseconds = date.getSeconds();\n\t\t\tmilliseconds = date.getMilliseconds();\n\t\t}\n\n\t\t// Go through each part and format/replace it in template\n\t\tfor (let i = 0, len = info.parts.length; i < len; i++) {\n\t\t\tlet value: string = \"\";\n\t\t\tswitch (info.parts[i]) {\n\n\t\t\t\tcase \"G\":\n\t\t\t\t\tvalue = this._t(\n\t\t\t\t\t\tfullYear < 0\n\t\t\t\t\t\t\t? \"_era_bc\"\n\t\t\t\t\t\t\t: \"_era_ad\"\n\t\t\t\t\t);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"yyyy\":\n\t\t\t\t\tvalue = Math.abs(fullYear).toString();\n\t\t\t\t\tif (fullYear < 0) {\n\t\t\t\t\t\tvalue += this._t(\"_era_bc\");\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"yyy\":\n\t\t\t\tcase \"yy\":\n\t\t\t\tcase \"y\":\n\t\t\t\t\tvalue = Math.abs(fullYear).toString().substr(-info.parts[i].length);\n\t\t\t\t\tif (fullYear < 0) {\n\t\t\t\t\t\tvalue += this._t(\"_era_bc\");\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"YYYY\":\n\t\t\t\tcase \"YYY\":\n\t\t\t\tcase \"YY\":\n\t\t\t\tcase \"Y\":\n\t\t\t\t\tlet week = $utils.getWeek(date);\n\t\t\t\t\tlet year = fullYear;\n\t\t\t\t\tif (week == 1 && (weekday > 4)) {\n\t\t\t\t\t\tyear--;\n\t\t\t\t\t}\n\t\t\t\t\tif (info.parts[i] == \"YYYY\") {\n\t\t\t\t\t\tvalue = Math.abs(year).toString();\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tvalue = Math.abs(year).toString().substr(-info.parts[i].length);\n\t\t\t\t\t}\n\t\t\t\t\tif (year < 0) {\n\t\t\t\t\t\tvalue += this._t(\"_era_bc\");\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"u\":\n\t\t\t\t\t// @todo\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"q\":\n\t\t\t\t\tvalue = \"\" + Math.ceil((date.getMonth() + 1) / 3);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"MMMMM\":\n\t\t\t\t\tvalue = this._t(this._getMonth(month)).substr(0, 1);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"MMMM\":\n\t\t\t\t\tvalue = this._t(this._getMonth(month));\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"MMM\":\n\t\t\t\t\tvalue = this._t(this._getShortMonth(month));\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"MM\":\n\t\t\t\t\tvalue = $utils.padString(month + 1, 2, \"0\");\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"M\":\n\t\t\t\t\tvalue = (month + 1).toString();\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"ww\":\n\t\t\t\t\tvalue = $utils.padString($utils.getWeek(date, this._root.utc), 2, \"0\");\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"w\":\n\t\t\t\t\tvalue = $utils.getWeek(date, this._root.utc).toString();\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"W\":\n\t\t\t\t\tvalue = $utils.getMonthWeek(date, this._root.utc).toString();\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"dd\":\n\t\t\t\t\tvalue = $utils.padString(day, 2, \"0\");\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"d\":\n\t\t\t\t\tvalue = day.toString();\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"DD\":\n\t\t\t\tcase \"DDD\":\n\t\t\t\t\tvalue = $utils.padString($utils.getYearDay(date, this._root.utc).toString(), info.parts[i].length, \"0\");\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"D\":\n\t\t\t\t\tvalue = $utils.getYearDay(date, this._root.utc).toString();\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"F\":\n\t\t\t\t\t// @todo\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"g\":\n\t\t\t\t\t// @todo\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"t\":\n\t\t\t\t\tvalue = this._root.language.translateFunc(\"_dateOrd\").call(this, day);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"E\":\n\t\t\t\t\tvalue = (weekday || 7).toString();\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"EE\":\n\t\t\t\t\tvalue = $utils.padString((weekday || 7).toString(), 2, \"0\");\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"EEE\":\n\t\t\t\tcase \"eee\":\n\t\t\t\t\tvalue = this._t(this._getShortWeekday(weekday));\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"EEEE\":\n\t\t\t\tcase \"eeee\":\n\t\t\t\t\tvalue = this._t(this._getShortWeekday(weekday));\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"EEEEE\":\n\t\t\t\tcase \"eeeee\":\n\t\t\t\t\tvalue = this._t(this._getShortWeekday(weekday)).substr(0, 1);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"e\":\n\t\t\t\tcase \"ee\":\n\t\t\t\t\tvalue = (weekday - (this._root.locale.firstDayOfWeek || 1) + 1).toString();\n\t\t\t\t\tif (info.parts[i] == \"ee\") {\n\t\t\t\t\t\tvalue = $utils.padString(value, 2, \"0\");\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"a\":\n\t\t\t\t\tif (hours >= 12) {\n\t\t\t\t\t\tvalue = this._t(\"PM\");\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tvalue = this._t(\"AM\");\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"aa\":\n\t\t\t\t\tif (hours >= 12) {\n\t\t\t\t\t\tvalue = this._t(\"P.M.\");\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tvalue = this._t(\"A.M.\");\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"aaa\":\n\t\t\t\t\tif (hours >= 12) {\n\t\t\t\t\t\tvalue = this._t(\"P\");\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tvalue = this._t(\"A\");\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"h\":\n\t\t\t\t\tvalue = $utils.get12Hours(hours).toString();\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"hh\":\n\t\t\t\t\tvalue = $utils.padString($utils.get12Hours(hours), 2, \"0\");\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"H\":\n\t\t\t\t\tvalue = hours.toString();\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"HH\":\n\t\t\t\t\tvalue = $utils.padString(hours, 2, \"0\");\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"K\":\n\t\t\t\t\tvalue = $utils.get12Hours(hours, 0).toString();\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"KK\":\n\t\t\t\t\tvalue = $utils.padString($utils.get12Hours(hours, 0), 2, \"0\");\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"k\":\n\t\t\t\t\tvalue = (hours + 1).toString();\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"kk\":\n\t\t\t\t\tvalue = $utils.padString(hours + 1, 2, \"0\");\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"m\":\n\t\t\t\t\tvalue = minutes.toString();\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"mm\":\n\t\t\t\t\tvalue = $utils.padString(minutes, 2, \"0\");\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"s\":\n\t\t\t\t\tvalue = seconds.toString();\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"ss\":\n\t\t\t\t\tvalue = $utils.padString(seconds, 2, \"0\");\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"S\":\n\t\t\t\tcase \"SS\":\n\t\t\t\tcase \"SSS\":\n\t\t\t\t\tvalue = Math.round((milliseconds / 1000) * Math.pow(10, info.parts[i].length)).toString();\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"x\":\n\t\t\t\t\tvalue = timestamp.toString();\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"n\":\n\t\t\t\tcase \"nn\":\n\t\t\t\tcase \"nnn\":\n\t\t\t\t\tvalue = $utils.padString(milliseconds, info.parts[i].length, \"0\");\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"z\":\n\t\t\t\t\tvalue = $utils.getTimeZone(date, false, false, this._root.utc);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"zz\":\n\t\t\t\t\tvalue = $utils.getTimeZone(date, true, false, this._root.utc);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"zzz\":\n\t\t\t\t\tvalue = $utils.getTimeZone(date, false, true, this._root.utc);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"zzzz\":\n\t\t\t\t\tvalue = $utils.getTimeZone(date, true, true, this._root.utc);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"Z\":\n\t\t\t\tcase \"ZZ\":\n\t\t\t\t\tlet tz = Math.abs(offset) / 60;\n\t\t\t\t\tlet tzh = Math.floor(tz);\n\t\t\t\t\tlet tzm = tz * 60 - tzh * 60;\n\n\t\t\t\t\tif (this._root.utc) {\n\t\t\t\t\t\ttzh = 0;\n\t\t\t\t\t\ttzm = 0;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (info.parts[i] == \"Z\") {\n\t\t\t\t\t\tvalue = \"GMT\";\n\t\t\t\t\t\tvalue += offset > 0 ? \"-\" : \"+\";\n\t\t\t\t\t\tvalue += $utils.padString(tzh, 2) + \":\" + $utils.padString(tzm, 2);\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tvalue = offset > 0 ? \"-\" : \"+\";\n\t\t\t\t\t\tvalue += $utils.padString(tzh, 2) + $utils.padString(tzm, 2);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"i\":\n\t\t\t\t\tvalue = date.toISOString();\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"I\":\n\t\t\t\t\tvalue = date.toUTCString();\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\t\t\tres = res.replace($type.PLACEHOLDER, value);\n\t\t}\n\n\t\treturn res;\n\t}\n\n\t/**\n\t * Parses format into structured infromation.\n\t *\n\t * @param format Format template\n\t */\n\tprotected parseFormat(format: string): DateFormatInfo {\n\n\t\t// Check cache\n\t\t// TODO: implement caching of the parsed format\n\n\t\t// Init format parse info holder\n\t\tlet info: DateFormatInfo = {\n\t\t\t\"template\": \"\",\n\t\t\t\"parts\": <any>[]\n\t\t};\n\n\t\t// Let TextFormatter split into chunks\n\t\tlet chunks = TextFormatter.chunk(format, true);\n\t\tfor (let i: number = 0; i < chunks.length; i++) {\n\t\t\tlet chunk = chunks[i];\n\n\t\t\tif (chunk.type === \"value\") {\n\n\t\t\t\t// Just \"Date\"?\n\t\t\t\tif (chunk.text.match(/^date$/i)) {\n\t\t\t\t\tlet dateFormat = this.get(\"dateFormat\", \"yyyy-MM-dd\");\n\t\t\t\t\tif (!$type.isString(dateFormat)) {\n\t\t\t\t\t\tdateFormat = \"yyyy-MM-dd\";\n\t\t\t\t\t}\n\t\t\t\t\tchunk.text = dateFormat;\n\t\t\t\t}\n\n\t\t\t\t// Find all possible parts\n\t\t\t\tlet matches = chunk.text.match(/G|yyyy|yyy|yy|y|YYYY|YYY|YY|Y|u|q|MMMMM|MMMM|MMM|MM|M|ww|w|W|dd|d|DDD|DD|D|F|g|EEEEE|EEEE|EEE|EE|E|eeeee|eeee|eee|ee|e|aaa|aa|a|hh|h|HH|H|KK|K|kk|k|mm|m|ss|s|SSS|SS|S|A|zzzz|zzz|zz|z|ZZ|Z|t|x|nnn|nn|n|i|I/g);\n\n\t\t\t\t// Found?\n\t\t\t\tif (matches) {\n\n\t\t\t\t\t// Populate template\n\t\t\t\t\tfor (let x = 0; x < matches.length; x++) {\n\t\t\t\t\t\tinfo.parts.push(matches[x]);\n\t\t\t\t\t\tchunk.text = chunk.text.replace(matches[x], $type.PLACEHOLDER);\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// Apply to template\n\t\t\tinfo.template += chunk.text;\n\t\t}\n\n\t\t// Save cache\n\t\t// TODO\n\n\t\treturn info;\n\t}\n\n\tprotected _months(): Months[] {\n\t\treturn [\"January\", \"February\", \"March\", \"April\", \"May\", \"June\", \"July\", \"August\", \"September\", \"October\", \"November\", \"December\"];\n\t}\n\n\tprotected _getMonth(index: number): Months {\n\t\treturn this._months()[index];\n\t}\n\n\tprotected _shortMonths(): ShortMonths[] {\n\t\treturn [\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"May(short)\", \"Jun\", \"Jul\", \"Aug\", \"Sep\", \"Oct\", \"Nov\", \"Dec\"];\n\t}\n\n\tprotected _getShortMonth(index: number): ShortMonths {\n\t\treturn this._shortMonths()[index];\n\t}\n\n\tprotected _weekdays(): Weekdays[] {\n\t\treturn [\"Sunday\", \"Monday\", \"Tuesday\", \"Wednesday\", \"Thursday\", \"Friday\", \"Saturday\"];\n\t}\n\n\tprotected _getWeekday(index: number): Weekdays {\n\t\treturn this._weekdays()[index];\n\t}\n\n\tprotected _shortWeekdays(): ShortWeekdays[] {\n\t\treturn [\"Sun\", \"Mon\", \"Tue\", \"Wed\", \"Thu\", \"Fri\", \"Sat\"];\n\t}\n\n\tprotected _getShortWeekday(index: number): ShortWeekdays {\n\t\treturn this._shortWeekdays()[index];\n\t}\n\n\tpublic parse(source: any, format: string): Date {\n\n\t\t// Is it already a Date\n\t\tif (source instanceof Date) {\n\t\t\treturn source;\n\t\t}\n\n\t\t// Is it a numeric timestamp\n\t\tif ($type.isNumber(source)) {\n\t\t\treturn new Date(source);\n\t\t}\n\n\t\t// No? Let's check if it's string, and try converting to it if nec\n\t\tif (!$type.isString(source)) {\n\t\t\tsource = source.toString();\n\t\t}\n\n\t\t// Init return value\n\t\tlet res: Date;\n\n\t\t// Init RegEx for parsing\n\t\tlet reg: string = \"\";\n\n\t\t// Clean format\n\t\tformat = $utils.cleanFormat(format);\n\n\t\t// Clip format to length of the source string\n\t\tformat = format.substr(0, source.length);\n\n\t\t// Parse format\n\t\tlet info = this.parseFormat(format);\n\n\t\t// Init parsed items holder\n\t\tlet parsedIndexes = {\n\t\t\t\"year\": -1,\n\t\t\t\"year3\": -1,\n\t\t\t\"year2\": -1,\n\t\t\t\"year1\": -1,\n\t\t\t\"month\": -1,\n\t\t\t\"monthShort\": -1,\n\t\t\t\"monthLong\": -1,\n\t\t\t\"weekdayShort\": -1,\n\t\t\t\"weekdayLong\": -1,\n\t\t\t\"day\": -1,\n\t\t\t\"yearDay\": -1,\n\t\t\t\"week\": -1,\n\t\t\t\"hourBase0\": -1,\n\t\t\t\"hour12Base0\": -1,\n\t\t\t\"hourBase1\": -1,\n\t\t\t\"hour12Base1\": -1,\n\t\t\t\"minute\": -1,\n\t\t\t\"second\": -1,\n\t\t\t\"millisecond\": -1,\n\t\t\t\"millisecondDigits\": -1,\n\t\t\t\"am\": -1,\n\t\t\t\"zone\": -1,\n\t\t\t\"timestamp\": -1,\n\t\t\t\"iso\": -1\n\t\t};\n\n\t\t// Init values\n\t\tlet resValues = {\n\t\t\t\"year\": 1970,\n\t\t\t\"month\": 0,\n\t\t\t\"day\": 1,\n\t\t\t\"hour\": 0,\n\t\t\t\"minute\": 0,\n\t\t\t\"second\": 0,\n\t\t\t\"millisecond\": 0,\n\t\t\t\"timestamp\": <any>null,\n\t\t\t\"offset\": 0,\n\t\t\t\"utc\": this._root.utc\n\t\t}\n\n\t\t// Index adjuster\n\t\tlet indexAdjust: number = 0;\n\t\tlet index: number = 0;\n\n\t\t// Iterate through all of the parts\n\t\tfor (let i: number = 0; i < info.parts.length; i++) {\n\n\t\t\t// Set current match index\n\t\t\tindex = i + indexAdjust + 1;\n\n\t\t\tswitch (info.parts[i]) {\n\n\t\t\t\tcase \"yyyy\":\n\t\t\t\tcase \"YYYY\":\n\t\t\t\t\treg += \"([0-9]{4})\";\n\t\t\t\t\tparsedIndexes.year = index;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"yyy\":\n\t\t\t\tcase \"YYY\":\n\t\t\t\t\treg += \"([0-9]{3})\";\n\t\t\t\t\tparsedIndexes.year3 = index;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"yy\":\n\t\t\t\tcase \"YY\":\n\t\t\t\t\treg += \"([0-9]{2})\";\n\t\t\t\t\tparsedIndexes.year2 = index;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"y\":\n\t\t\t\tcase \"Y\":\n\t\t\t\t\treg += \"([0-9]{1})\";\n\t\t\t\t\tparsedIndexes.year1 = index;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"MMMM\":\n\t\t\t\t\treg += \"(\" + this.getStringList(this._months()).join(\"|\") + \")\";\n\t\t\t\t\tparsedIndexes.monthLong = index;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"MMM\":\n\t\t\t\t\treg += \"(\" + this.getStringList(this._shortMonths()).join(\"|\") + \")\";\n\t\t\t\t\tparsedIndexes.monthShort = index;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"MM\":\n\t\t\t\tcase \"M\":\n\t\t\t\t\treg += \"([0-9]{2}|[0-9]{1})\";\n\t\t\t\t\tparsedIndexes.month = index;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"ww\":\n\t\t\t\tcase \"w\":\n\t\t\t\t\treg += \"([0-9]{2}|[0-9]{1})\";\n\t\t\t\t\tparsedIndexes.week = index;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"dd\":\n\t\t\t\tcase \"d\":\n\t\t\t\t\treg += \"([0-9]{2}|[0-9]{1})\";\n\t\t\t\t\tparsedIndexes.day = index;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"DDD\":\n\t\t\t\tcase \"DD\":\n\t\t\t\tcase \"D\":\n\t\t\t\t\treg += \"([0-9]{3}|[0-9]{2}|[0-9]{1})\";\n\t\t\t\t\tparsedIndexes.yearDay = index;\n\t\t\t\t\tbreak;\n\n\n\t\t\t\tcase \"dddd\":\n\t\t\t\t\treg += \"(\" + this.getStringList(this._weekdays()).join(\"|\") + \")\";\n\t\t\t\t\tparsedIndexes.weekdayLong = index;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"ddd\":\n\t\t\t\t\treg += \"(\" + this.getStringList(this._shortWeekdays()).join(\"|\") + \")\";\n\t\t\t\t\tparsedIndexes.weekdayShort = index;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"aaa\":\n\t\t\t\tcase \"aa\":\n\t\t\t\tcase \"a\":\n\t\t\t\t\t// TODO: fix (escape regex)\n\t\t\t\t\treg += \"(\" + this.getStringList([\"AM\", \"PM\", \"A\\.M\\.\", \"P\\.M\\.\", \"A\", \"P\"]).join(\"|\") + \")\";\n\t\t\t\t\tparsedIndexes.am = index;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"hh\":\n\t\t\t\tcase \"h\":\n\t\t\t\t\treg += \"([0-9]{2}|[0-9]{1})\";\n\t\t\t\t\tparsedIndexes.hour12Base1 = index;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"HH\":\n\t\t\t\tcase \"H\":\n\t\t\t\t\treg += \"([0-9]{2}|[0-9]{1})\";\n\t\t\t\t\tparsedIndexes.hourBase0 = index;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"KK\":\n\t\t\t\tcase \"K\":\n\t\t\t\t\treg += \"([0-9]{2}|[0-9]{1})\";\n\t\t\t\t\tparsedIndexes.hour12Base0 = index;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"kk\":\n\t\t\t\tcase \"k\":\n\t\t\t\t\treg += \"([0-9]{2}|[0-9]{1})\";\n\t\t\t\t\tparsedIndexes.hourBase1 = index;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"mm\":\n\t\t\t\tcase \"m\":\n\t\t\t\t\treg += \"([0-9]{2}|[0-9]{1})\";\n\t\t\t\t\tparsedIndexes.minute = index;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"ss\":\n\t\t\t\tcase \"s\":\n\t\t\t\t\treg += \"([0-9]{2}|[0-9]{1})\";\n\t\t\t\t\tparsedIndexes.second = index;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"SSS\":\n\t\t\t\tcase \"SS\":\n\t\t\t\tcase \"S\":\n\t\t\t\t\treg += \"([0-9]{3}|[0-9]{2}|[0-9]{1})\";\n\t\t\t\t\tparsedIndexes.millisecond = index;\n\t\t\t\t\tparsedIndexes.millisecondDigits = info.parts[i].length;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"nnn\":\n\t\t\t\tcase \"nn\":\n\t\t\t\tcase \"n\":\n\t\t\t\t\treg += \"([0-9]{3}|[0-9]{2}|[0-9]{1})\";\n\t\t\t\t\tparsedIndexes.millisecond = index;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"x\":\n\t\t\t\t\treg += \"([0-9]{1,})\";\n\t\t\t\t\tparsedIndexes.timestamp = index;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"Z\":\n\t\t\t\t\treg += \"GMT([-+]+[0-9]{2}:[0-9]{2})\";\n\t\t\t\t\tparsedIndexes.zone = index;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"ZZ\":\n\t\t\t\t\treg += \"([\\\\-+]+[0-9]{2}[0-9]{2})\";\n\t\t\t\t\tparsedIndexes.zone = index;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"i\":\n\t\t\t\t\treg += \"([0-9]{4})-?([0-9]{2})-?([0-9]{2})T?([0-9]{2}):?([0-9]{2}):?([0-9]{2})\\.?([0-9]{0,3})([zZ]|[+\\-][0-9]{2}:?[0-9]{2}|$)\";\n\t\t\t\t\tparsedIndexes.iso = index;\n\t\t\t\t\tindexAdjust += 7;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"G\":\n\t\t\t\tcase \"YYYY\":\n\t\t\t\tcase \"YYY\":\n\t\t\t\tcase \"YY\":\n\t\t\t\tcase \"Y\":\n\t\t\t\tcase \"MMMMM\":\n\t\t\t\tcase \"W\":\n\t\t\t\tcase \"EEEEE\":\n\t\t\t\tcase \"EEEE\":\n\t\t\t\tcase \"EEE\":\n\t\t\t\tcase \"EE\":\n\t\t\t\tcase \"E\":\n\t\t\t\tcase \"eeeee\":\n\t\t\t\tcase \"eeee\":\n\t\t\t\tcase \"eee\":\n\t\t\t\tcase \"ee\":\n\t\t\t\tcase \"e\":\n\t\t\t\tcase \"zzzz\":\n\t\t\t\tcase \"zzz\":\n\t\t\t\tcase \"zz\":\n\t\t\t\tcase \"z\":\n\t\t\t\tcase \"t\":\n\t\t\t\t\t// Ignore\n\t\t\t\t\tindexAdjust--;\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\treg += \"[^0-9]*\";\n\t\t}\n\n\t\t// Try matching\n\t\tlet regex = new RegExp(reg);\n\t\tlet matches: RegExpMatchArray = source.match(regex);\n\n\t\tif (matches) {\n\t\t\t// Populate the date object\n\n\t\t\t// Full year\n\t\t\tif (parsedIndexes.year > -1) {\n\t\t\t\tresValues.year = parseInt(matches[parsedIndexes.year]);\n\t\t\t}\n\n\t\t\t// 3-digit year\n\t\t\tif (parsedIndexes.year3 > -1) {\n\t\t\t\tlet val = parseInt(matches[parsedIndexes.year3]);\n\t\t\t\tval += 1000;\n\t\t\t\tresValues.year = val;\n\t\t\t}\n\n\t\t\t// 2-digit year\n\t\t\tif (parsedIndexes.year2 > -1) {\n\t\t\t\tlet val = parseInt(matches[parsedIndexes.year2]);\n\t\t\t\tif (val > 50) {\n\t\t\t\t\tval += 1000;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tval += 2000;\n\t\t\t\t}\n\t\t\t\tresValues.year = val;\n\t\t\t}\n\n\t\t\t// 1-digit year\n\t\t\tif (parsedIndexes.year1 > -1) {\n\t\t\t\tlet val = parseInt(matches[parsedIndexes.year1]);\n\t\t\t\tval = Math.floor((new Date().getFullYear()) / 10) * 10 + val;\n\t\t\t\tresValues.year = val;\n\t\t\t}\n\n\t\t\t// Full month\n\t\t\tif (parsedIndexes.monthLong > -1) {\n\t\t\t\tresValues.month = this.resolveMonth(<any>matches[parsedIndexes.monthLong]);\n\t\t\t}\n\n\t\t\t// Short month\n\t\t\tif (parsedIndexes.monthShort > -1) {\n\t\t\t\tresValues.month = this.resolveShortMonth(<any>matches[parsedIndexes.monthShort]);\n\t\t\t}\n\n\t\t\t// Numeric month\n\t\t\tif (parsedIndexes.month > -1) {\n\t\t\t\tresValues.month = parseInt(matches[parsedIndexes.month]) - 1;\n\t\t\t}\n\n\t\t\t// Weekday\n\t\t\t// @todo\n\n\t\t\t// Week\n\t\t\tif ((parsedIndexes.week > -1) && (parsedIndexes.day === -1)) {\n\t\t\t\t// We parse weeks ONLY if day is not explicitly set\n\t\t\t\t// TODO: this needs work\n\t\t\t\t// (but maybe later - I can hardly imagine anyone passing their dates in weeks)\n\t\t\t\tresValues.month = 0;\n\t\t\t\tresValues.day = $utils.getDayFromWeek(\n\t\t\t\t\tparseInt(matches[parsedIndexes.week]),\n\t\t\t\t\tresValues.year,\n\t\t\t\t\t1,\n\t\t\t\t\tthis._root.utc\n\t\t\t\t);\n\t\t\t}\n\n\t\t\t// Day\n\t\t\tif (parsedIndexes.day > -1) {\n\t\t\t\tresValues.day = parseInt(matches[parsedIndexes.day]);\n\t\t\t}\n\n\t\t\t// Year day\n\t\t\tif (parsedIndexes.yearDay > -1) {\n\t\t\t\tresValues.month = 0;\n\t\t\t\tresValues.day = parseInt(matches[parsedIndexes.yearDay]);\n\t\t\t}\n\n\t\t\t// 24 Hour (0-23)\n\t\t\tif (parsedIndexes.hourBase0 > -1) {\n\t\t\t\tresValues.hour = parseInt(matches[parsedIndexes.hourBase0]);\n\t\t\t}\n\n\t\t\t// 24 Hour (1-24)\n\t\t\tif (parsedIndexes.hourBase1 > -1) {\n\t\t\t\tresValues.hour = parseInt(matches[parsedIndexes.hourBase1]) - 1;\n\t\t\t}\n\n\t\t\t// 12 Hour (0-11)\n\t\t\tif (parsedIndexes.hour12Base0 > -1) {\n\t\t\t\tlet val = parseInt(matches[parsedIndexes.hour12Base0]);\n\t\t\t\tif (val == 11) {\n\t\t\t\t\tval = 0;\n\t\t\t\t}\n\t\t\t\tif ((parsedIndexes.am > -1) && !this.isAm(matches[parsedIndexes.am])) {\n\t\t\t\t\tval += 12;\n\t\t\t\t}\n\t\t\t\tresValues.hour = val;\n\t\t\t}\n\n\t\t\t// 12 Hour (1-12)\n\t\t\tif (parsedIndexes.hour12Base1 > -1) {\n\t\t\t\tlet val = parseInt(matches[parsedIndexes.hour12Base1]);\n\t\t\t\tif (val == 12) {\n\t\t\t\t\tval = 0;\n\t\t\t\t}\n\t\t\t\tif ((parsedIndexes.am > -1) && !this.isAm(matches[parsedIndexes.am])) {\n\t\t\t\t\tval += 12;\n\t\t\t\t}\n\t\t\t\tresValues.hour = val;\n\t\t\t}\n\n\t\t\t// Minute\n\t\t\tif (parsedIndexes.minute > -1) {\n\t\t\t\tresValues.minute = parseInt(matches[parsedIndexes.minute]);\n\t\t\t}\n\n\t\t\t// Second\n\t\t\tif (parsedIndexes.second > -1) {\n\t\t\t\tresValues.second = parseInt(matches[parsedIndexes.second]);\n\t\t\t}\n\n\t\t\t// Millisecond\n\t\t\tif (parsedIndexes.millisecond > -1) {\n\t\t\t\tlet val = parseInt(matches[parsedIndexes.millisecond]);\n\t\t\t\tif (parsedIndexes.millisecondDigits == 2) {\n\t\t\t\t\tval *= 10;\n\t\t\t\t}\n\t\t\t\telse if (parsedIndexes.millisecondDigits == 1) {\n\t\t\t\t\tval *= 100;\n\t\t\t\t}\n\t\t\t\tresValues.millisecond = val;\n\t\t\t}\n\n\t\t\t// Timestamp\n\t\t\tif (parsedIndexes.timestamp > -1) {\n\t\t\t\tresValues.timestamp = parseInt(matches[parsedIndexes.timestamp]);\n\n\t\t\t\tconst ts = new Date(resValues.timestamp);\n\t\t\t\tresValues.year = ts.getUTCFullYear();\n\t\t\t\tresValues.month = ts.getUTCMonth();\n\t\t\t\tresValues.day = ts.getUTCDate();\n\t\t\t\tresValues.hour = ts.getUTCHours();\n\t\t\t\tresValues.minute = ts.getUTCMinutes();\n\t\t\t\tresValues.second = ts.getUTCSeconds();\n\t\t\t\tresValues.millisecond = ts.getUTCMilliseconds();\n\t\t\t}\n\n\t\t\t// Adjust time zone\n\t\t\tif (parsedIndexes.zone > -1) {\n\t\t\t\tresValues.offset = this.resolveTimezoneOffset(new Date(resValues.year, resValues.month, resValues.day), matches[parsedIndexes.zone]);\n\t\t\t}\n\n\t\t\t// ISO\n\t\t\tif (parsedIndexes.iso > -1) {\n\n\t\t\t\tresValues.year = $type.toNumber(matches[parsedIndexes.iso + 0]);\n\t\t\t\tresValues.month = $type.toNumber(matches[parsedIndexes.iso + 1]) - 1;\n\t\t\t\tresValues.day = $type.toNumber(matches[parsedIndexes.iso + 2]);\n\t\t\t\tresValues.hour = $type.toNumber(matches[parsedIndexes.iso + 3]);\n\t\t\t\tresValues.minute = $type.toNumber(matches[parsedIndexes.iso + 4]);\n\t\t\t\tresValues.second = $type.toNumber(matches[parsedIndexes.iso + 5]);\n\t\t\t\tresValues.millisecond = $type.toNumber(matches[parsedIndexes.iso + 6]);\n\n\t\t\t\tif (matches[parsedIndexes.iso + 7] == \"Z\" || matches[parsedIndexes.iso + 7] == \"z\") {\n\t\t\t\t\tresValues.utc = true;\n\t\t\t\t}\n\t\t\t\telse if (matches[parsedIndexes.iso + 7] != \"\") {\n\t\t\t\t\tresValues.offset = this.resolveTimezoneOffset(new Date(resValues.year, resValues.month, resValues.day), matches[parsedIndexes.iso + 7]);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Create Date object\n\t\t\tif (resValues.utc) {\n\t\t\t\tres = new Date(Date.UTC(\n\t\t\t\t\tresValues.year,\n\t\t\t\t\tresValues.month,\n\t\t\t\t\tresValues.day,\n\t\t\t\t\tresValues.hour,\n\t\t\t\t\tresValues.minute,\n\t\t\t\t\tresValues.second,\n\t\t\t\t\tresValues.millisecond\n\t\t\t\t));\n\t\t\t}\n\t\t\telse {\n\t\t\t\tres = new Date(\n\t\t\t\t\tresValues.year,\n\t\t\t\t\tresValues.month,\n\t\t\t\t\tresValues.day,\n\t\t\t\t\tresValues.hour,\n\t\t\t\t\tresValues.minute + resValues.offset,\n\t\t\t\t\tresValues.second,\n\t\t\t\t\tresValues.millisecond\n\t\t\t\t);\n\t\t\t}\n\n\t\t}\n\t\telse {\n\t\t\t// Didn't match anything\n\t\t\t// Let's try dropping it into Date constructor and hope for the best\n\t\t\tres = new Date(source);\n\t\t}\n\n\t\treturn res;\n\t}\n\n\tprotected resolveTimezoneOffset(date: Date, zone: string): number {\n\t\tlet value = zone.match(/([+\\-]?)([0-9]{2}):?([0-9]{2})/);\n\t\tif (value) {\n\t\t\tlet match = zone.match(/([+\\-]?)([0-9]{2}):?([0-9]{2})/)!;\n\t\t\tlet dir = match[1];\n\t\t\tlet hour = match[2];\n\t\t\tlet minute = match[3];\n\t\t\tlet offset = parseInt(hour) * 60 + parseInt(minute);\n\n\t\t\t// Adjust offset\n\t\t\t// Making it negative does not seem to make sense, but it's right\n\t\t\t// because of how JavaScript calculates GMT offsets\n\t\t\tif (dir == \"+\") {\n\t\t\t\toffset *= -1;\n\t\t\t}\n\n\t\t\t// Check the difference in offset\n\t\t\tlet originalOffset = (date || new Date()).getTimezoneOffset();\n\t\t\tlet diff = offset - originalOffset;\n\t\t\treturn diff;\n\t\t}\n\t\treturn 0;\n\t}\n\n\t/**\n\t * Resolves month name (i.e. \"December\") into a month number (11).\n\t *\n\t * @param value  Month name\n\t * @return Month number\n\t */\n\tprotected resolveMonth(value: Months): number {\n\n\t\t// Let's try English first\n\t\tlet month: number = this._months().indexOf(value);\n\t\tif (month > -1) {\n\t\t\treturn month;\n\t\t}\n\n\t\t// Try the translation\n\t\tif (!this._root.language.isDefault()) {\n\t\t\tmonth = this._root.language.translateAll(this._months()).indexOf(value);\n\t\t\tif (month > -1) {\n\t\t\t\treturn month\n\t\t\t}\n\t\t}\n\n\t\treturn 0;\n\t}\n\n\t/**\n\t * Resolves short month name (i.e. \"Dec\") into a month number.\n\t *\n\t * @param value  Short month name\n\t * @return Month number\n\t */\n\tprotected resolveShortMonth(value: ShortMonths): number {\n\n\t\t// Let's try English first\n\t\tlet month: number = this._shortMonths().indexOf(value);\n\t\tif (month > -1) {\n\t\t\treturn month;\n\t\t}\n\n\t\t// Maybe long month (workaround for May)\n\t\tmonth = this._months().indexOf(<any>value);\n\t\tif (month > -1) {\n\t\t\treturn month;\n\t\t}\n\n\t\t// Try the translation\n\t\tif (this._root.language && !this._root.language.isDefault()) {\n\t\t\tmonth = this._root.language.translateAll(this._shortMonths()).indexOf(value);\n\t\t\tif (month > -1) {\n\t\t\t\treturn month\n\t\t\t}\n\t\t}\n\n\t\treturn 0;\n\t}\n\n\t/**\n\t * Checks if passed in string represents AM/PM notation in many of its\n\t * versions.\n\t *\n\t * @param value  Source string\n\t * @return Is it AM/PM?\n\t */\n\tprotected isAm(value: string): boolean {\n\t\tlet list = this.getStringList([\"AM\", \"A.M.\", \"A\"]);\n\t\treturn list.indexOf(value.toUpperCase()) > -1;\n\t}\n\n\t/**\n\t * Translates list of strings.\n\t *\n\t * @param list  Source strings\n\t * @return Translated strings\n\t */\n\tprotected getStringList(list: Array<keyof ILocaleSettings>): Array<string> {\n\t\tlet res: string[] = [];\n\t\tfor (let i: number = 0; i < list.length; i++) {\n\t\t\t// translate?\n\t\t\tif (this._root.language) {\n\t\t\t\tres.push($utils.escapeForRgex(this._t(list[i])));\n\t\t\t}\n\t\t\telse {\n\t\t\t\tres.push($utils.escapeForRgex(list[i]));\n\t\t\t}\n\t\t}\n\t\treturn res;\n\t}\n\n}\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}