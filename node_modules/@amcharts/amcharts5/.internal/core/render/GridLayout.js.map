{"version":3,"file":"GridLayout.js","sourceRoot":"","sources":["../../../../../src/.internal/core/render/GridLayout.ts"],"names":[],"mappings":"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","sourcesContent":["import { Layout, ILayoutSettings, ILayoutPrivate } from \"./Layout\";\nimport * as $array from \"../util/Array\";\nimport * as $math from \"../util/Math\";\nimport type { Container } from \"./Container\";\nimport type { List } from \"../util/List\";\nimport type { Sprite } from \"./Sprite\";\n\n\nexport interface IGridLayoutSettings extends ILayoutSettings {\n\n\t/**\n\t * If set to `true` all columns in the grid will be equal width.\n\t *\n\t * @default false\n\t */\n\tfixedWidthGrid?: boolean;\n\n\t/**\n\t * Maximum number of columns in the grid.\n\t */\n\tmaxColumns?: number;\n\n}\n\nexport interface IGridLayoutPrivate extends ILayoutPrivate {\n}\n\n/**\n * A grid children layout for [[Container]].\n *\n * @see {@link https://www.amcharts.com/docs/v5/concepts/common-elements/containers/#Layout} for more info\n */\nexport class GridLayout extends Layout {\n\n\tpublic static className: string = \"GridLayout\";\n\tpublic static classNames: Array<string> = Layout.classNames.concat([GridLayout.className]);\n\n\tdeclare public _settings: IGridLayoutSettings;\n\tdeclare public _privateSettings: IGridLayoutPrivate;\n\n\n\tprotected _afterNew() {\n\t\tthis._setRawDefault(\"maxColumns\", Number.MAX_VALUE);\n\t\tsuper._afterNew();\n\t}\n\n\t/**\n\t * @ignore\n\t */\n\tpublic updateContainer(container: Container): void {\n\t\tlet paddingLeft = container.get(\"paddingLeft\", 0);\n\t\tlet paddingRight = container.get(\"paddingRight\", 0);\n\t\tlet paddingTop = container.get(\"paddingTop\", 0);\n\n\t\tlet availableWidth = container.maxWidth() - paddingLeft - paddingRight;\n\n\t\tlet minCellWidth = availableWidth;\n\t\tlet maxCellWidth = 1;\n\n\t\tcontainer.children.each((child) => {\n\t\t\tif (child.get(\"position\") != \"absolute\") {\n\t\t\t\tlet childWidth = child.width();\n\n\t\t\t\tif (childWidth < minCellWidth) {\n\t\t\t\t\tminCellWidth = childWidth;\n\t\t\t\t}\n\t\t\t\tif (childWidth > maxCellWidth) {\n\t\t\t\t\tmaxCellWidth = childWidth;\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\n\t\tminCellWidth = $math.fitToRange(minCellWidth, 1, availableWidth);\n\t\tmaxCellWidth = $math.fitToRange(maxCellWidth, 1, availableWidth);\n\n\t\tlet columnCount = 1;\n\t\tif (this.get(\"fixedWidthGrid\")) {\n\t\t\tcolumnCount = availableWidth / maxCellWidth;\n\t\t}\n\t\telse {\n\t\t\tcolumnCount = availableWidth / minCellWidth;\n\t\t}\n\n\t\tcolumnCount = Math.max(1, Math.floor(columnCount));\n\t\tcolumnCount = Math.min(this.get(\"maxColumns\", Number.MAX_VALUE), columnCount);\n\n\t\tlet columnWidths = this.getColumnWidths(container.children, columnCount, maxCellWidth, availableWidth);\n\n\t\tlet prevY = paddingTop;\n\n\t\tlet column = 0;\n\t\tlet maxColumnHeight = 0;\n\n\t\tcolumnCount = columnWidths.length;\n\n\t\tlet prevX = paddingLeft;\n\n\t\tcontainer.children.each((child) => {\n\t\t\tif (child.get(\"position\") == \"relative\") {\n\t\t\t\tconst marginTop = child.get(\"marginTop\", 0);\n\t\t\t\tconst marginBottom = child.get(\"marginBottom\", 0);\n\n\t\t\t\tlet bounds = child.adjustedLocalBounds();\n\t\t\t\tlet marginLeft = child.get(\"marginLeft\", 0);\n\t\t\t\tlet marginRight = child.get(\"marginRight\", 0);\n\t\t\t\tlet x = prevX + marginLeft - bounds.left;\n\t\t\t\tlet y = prevY + marginTop - bounds.top;\n\n\t\t\t\tchild.setPrivate(\"x\", x);\n\t\t\t\tchild.setPrivate(\"y\", y);\n\n\t\t\t\tprevX += columnWidths[column] + marginRight;\n\n\t\t\t\tmaxColumnHeight = Math.max(maxColumnHeight, child.height() + marginTop + marginBottom);\n\n\t\t\t\tcolumn++;\n\n\t\t\t\tif (column >= columnCount) {\n\t\t\t\t\tcolumn = 0;\n\t\t\t\t\tprevX = paddingLeft;\n\t\t\t\t\tprevY += maxColumnHeight;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * @ignore\n\t */\n\tpublic getColumnWidths(children: List<Sprite>, columnCount: number, maxCellWidth: number, availableWidth: number): number[] {\n\t\tlet totalWidth = 0;\n\t\tlet columnWidths: Array<number> = [];\n\t\tlet column = 0;\n\n\t\tchildren.each((child) => {\n\t\t\tlet bounds = child.adjustedLocalBounds();\n\t\t\tif (child.get(\"position\") != \"absolute\") {\n\t\t\t\tif (this.get(\"fixedWidthGrid\")) {\n\t\t\t\t\tcolumnWidths[column] = maxCellWidth;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tcolumnWidths[column] = Math.max(columnWidths[column] | 0, bounds.right - bounds.left + child.get(\"marginLeft\", 0) + child.get(\"marginRight\", 0));\n\t\t\t\t}\n\n\t\t\t\tif (column < children.length - 1) {\n\t\t\t\t\tcolumn++;\n\n\t\t\t\t\tif (column == columnCount) {\n\t\t\t\t\t\tcolumn = 0;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\t$array.each(columnWidths, (w) => {\n\t\t\ttotalWidth += w;\n\t\t})\n\n\t\tif (totalWidth > availableWidth) {\n\t\t\tif (columnCount > 2) {\n\t\t\t\tcolumnCount -= 1;\n\t\t\t\treturn this.getColumnWidths(children, columnCount, maxCellWidth, availableWidth);\n\t\t\t}\n\t\t\telse {\n\t\t\t\treturn [availableWidth];\n\t\t\t}\n\t\t}\n\n\t\treturn columnWidths;\n\t}\n}\n"]}