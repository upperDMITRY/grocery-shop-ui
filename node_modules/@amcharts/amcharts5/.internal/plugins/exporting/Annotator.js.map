{"version":3,"file":"Annotator.js","sourceRoot":"","sources":["../../../../../src/.internal/plugins/exporting/Annotator.ts"],"names":[],"mappings":"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","sourcesContent":["import { Entity, IEntitySettings, IEntityPrivate, IEntityEvents } from \"../../core/util/Entity\"\nimport { Container } from \"../../core/render/Container\";\nimport { Picture } from \"../../core/render/Picture\";\n\nimport { p100 } from \"../../core/util/Percent\";\n\nexport interface IAnnotatorSettings extends IEntitySettings {\n\n\t/**\n\t * Layer number to use for annotations.\n\t * \n\t * @default 1000\n\t */\n\tlayer?: number;\n\n\t/**\n\t * Raw annotation info saved by MarkerJS.\n\t */\n\tmarkerState?: any;\n\n}\n\nexport interface IAnnotatorPrivate extends IEntityPrivate {\n}\n\nexport interface IAnnotatorEvents extends IEntityEvents {\n}\n\n\n\n/**\n * A plugin that can be used to annotate charts.\n *\n * @see {@link https://www.amcharts.com/docs/v5/concepts/exporting/annotator/} for more info\n */\nexport class Annotator extends Entity {\n\tpublic static className: string = \"Annotator\";\n\tpublic static classNames: Array<string> = Entity.classNames.concat([Annotator.className]);\n\n\tdeclare public _settings: IAnnotatorSettings;\n\tdeclare public _privateSettings: IAnnotatorPrivate;\n\tdeclare public _events: IAnnotatorEvents;\n\n\tprivate _container?: Container;\n\tprivate _picture?: Picture;\n\tprivate _markerArea?: any;\n\n\t//public extraImages: Array<Root | IAnnotatorImageSource> = [];\n\t//public dataSources: any[] = [];\n\n\tprotected _afterNew() {\n\t\tsuper._afterNew();\n\t\tthis._setRawDefault(\"layer\", 1000);\n\t\tthis._root.addDisposer(this);\n\n\t\tif (this.get(\"markerState\")) {\n\t\t\t// Preload image\n\t\t\tthis.open();\n\t\t\tthis.close();\n\t\t}\n\t}\n\n\tpublic _beforeChanged() {\n\t\tsuper._beforeChanged();\n\t}\n\n\t/**\n\t * Triggers annotation mode on the chart. This will display UI toolbars and\n\t * disable all interactions on the chart itself.\n\t */\n\tpublic async open() {\n\n\t\t// Delay this so that it's not knocked off by closing of the ExportingMenu\n\t\tthis.setTimeout(() => {\n\t\t\tthis._root._renderer.interactionsEnabled = false;\n\t\t}, 100)\n\n\t\tconst markerArea = await this.getMarkerArea();\n\t\tmarkerArea.show();\n\t\tthis._picture!.hide(0);\n\t\tif (this.get(\"markerState\")) {\n\t\t\tmarkerArea.restoreState(this.get(\"markerState\"));\n\t\t}\n\t}\n\n\t/**\n\t * Exists from annotation mode. All annotations remain visible on the chart.\n\t */\n\tpublic async close() {\n\t\tthis._root._renderer.interactionsEnabled = true;\n\t\tconst markerArea = await this.getMarkerArea();\n\t\tthis._picture!.show(0);\n\t\tmarkerArea!.close();\n\t}\n\n\t/**\n\t * Exits from annotation mode. Any changes made during last session of the\n\t * annotation editing are cancelled.\n\t */\n\tpublic async cancel() {\n\t\tthis._root._renderer.interactionsEnabled = true;\n\t\tconst markerArea = await this.getMarkerArea();\n\t\tthis._picture!.show(0);\n\t\tmarkerArea!.cancel();\n\t}\n\n\t/**\n\t * All annotations are removed.\n\t */\n\tpublic clear() {\n\t\tthis.set(\"markerState\", undefined);\n\t\tif (this._picture) {\n\t\t\tthis._picture.set(\"src\", \"\");\n\t\t}\n\t}\n\n\tpublic async toggle() {\n\t\tconst markerArea = await this.getMarkerArea();\n\t\tif (markerArea.isOpen) {\n\t\t\tthis.close();\n\t\t}\n\t\telse {\n\t\t\tthis.open();\n\t\t}\n\t}\n\n\tpublic dispose(): void {\n\t\tsuper.dispose();\n\t\tif (this._markerArea && this._markerArea.isOpen) {\n\t\t\tthis._markerArea.close();\n\t\t}\n\t}\n\n\tprivate async _maybeInit() {\n\n\t\t// Create layer canvas\n\t\tif (!this._container) {\n\t\t\tthis._container = this._root.container.children.push(Container.new(this._root, {\n\t\t\t\twidth: p100,\n\t\t\t\theight: p100,\n\t\t\t\tlayer: this.get(\"layer\"),\n\t\t\t\tinteractiveChildren: false\n\t\t\t}));\n\n\t\t\tthis._picture = this._container.children.push(Picture.new(this._root, {\n\t\t\t\twidth: p100,\n\t\t\t\theight: p100\n\t\t\t}));\n\t\t}\n\n\t\t// Create MarkerArea\n\t\tif (!this._markerArea) {\n\t\t\tconst markerjs2 = await this._getMarkerArea();\n\t\t\tconst canvas = this._container._display.getCanvas();\n\t\t\tconst markerArea = new markerjs2.MarkerArea(canvas);\n\t\t\t//markerArea.renderTarget = canvas;\n\t\t\tmarkerArea.uiStyleSettings.logoPosition = \"right\";\n\t\t\tmarkerArea.uiStyleSettings.zIndex = 20;\n\t\t\tmarkerArea.targetRoot = canvas.parentElement!;\n\n\t\t\tmarkerArea.addRenderEventListener((img: any, state: any) => {\n\t\t\t\tconst picture = this._picture!;\n\t\t\t\tpicture.set(\"src\", img);\n\t\t\t\tpicture.show(0);\n\t\t\t\tthis.set(\"markerState\", state);\n\t\t\t});\n\n\t\t\tthis._markerArea = markerArea;\n\t\t}\n\t}\n\n\t/**\n\t * @ignore\n\t */\n\tprivate async _getMarkerArea(): Promise<any> {\n\t\treturn await import(/* webpackChunkName: \"markerjs2\" */ \"markerjs2\");\n\t}\n\n\t/**\n\t * An instance of MarkerJS's [[MarkerArea]].\n\t *\n\t * @see {@link https://markerjs.com/docs/getting-started} for more info\n\t * @return MarkerArea\n\t */\n\tpublic async getMarkerArea(): Promise<any> {\n\t\tawait this._maybeInit();\n\t\treturn this._markerArea;\n\t}\n\n}"]}